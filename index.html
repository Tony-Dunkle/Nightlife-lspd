<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPD Internal Portal - Official Member Access</title>
    <link rel="icon" href="https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        setTimeout(() => {
            // Prioritize the platform-provided config, but use the hardcoded one as a fallback.
            const firebaseConfig = typeof __firebase_config !== 'undefined'
                ? JSON.parse(__firebase_config)
                : {
                    apiKey: "AIzaSyDU7DRAxCzqu81DTa7k0DXaBRcMpk0sElc",
                    authDomain: "upd-system.firebaseapp.com",
                    projectId: "upd-system",
                    storageBucket: "upd-system.appspot.com",
                    messagingSenderId: "28223003678",
                    appId: "1:28223003678:web:d1f8a6b0c2e3a4b5c6d7e8"
                };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);

            window.firebaseAuth = auth;
            window.signInWithEmailAndPassword = signInWithEmailAndPassword;
            window.onAuthStateChanged = onAuthStateChanged;
            window.signOut = signOut;
        }, 500); // 500ms delay
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display.swap');

        /* Define CSS variables for theming */
        :root {
            --bg-primary: #f8fafc; /* slate-50 */
            --bg-secondary: #ffffff; /* white */
            --bg-tertiary: #f1f5f9; /* slate-100 */
            --text-primary: #0f172a; /* slate-900 */
            --text-secondary: #475569; /* slate-600 */
            --border-color: #e2e8f0; /* slate-200 */
            --accent-color: #3b82f6; /* blue-500 */
            --modal-bg: rgba(0,0,0,0.7);
            --modal-content-bg: #ffffff;
        }

        html.dark {
            --bg-primary: #0f172a; /* slate-900 */
            --bg-secondary: #1e293b; /* slate-800 */
            --bg-tertiary: #334155; /* slate-700 */
            --text-primary: #f1f5f9; /* slate-100 */
            --text-secondary: #94a3b8; /* slate-400 */
            --border-color: #334155; /* slate-700 */
            --accent-color: #60a5fa; /* blue-400 */
            --modal-content-bg: #1e293b; /* slate-800 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        /* Scrollbar styles */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: #555;
            }

        html.dark ::-webkit-scrollbar-thumb {
            background: #555;
        }

            html.dark ::-webkit-scrollbar-thumb:hover {
                background: #777;
            }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background-color: var(--modal-bg);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

            .modal-overlay.is-open {
                display: flex;
            }

        .modal-box {
            background-color: var(--modal-content-bg);
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            width: 90%;
            max-width: 500px;
        }

        .data-modal-box {
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Sidebar specific styles */
        #sidebar {
            transition: transform 0.3s ease-in-out;
        }

            #sidebar.sidebar-hidden {
                transform: translateX(-100%);
            }

        /* Hero Video Background */
        .background-video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

            .background-video-container video {
                width: 100%;
                height: 100%;
                object-fit: cover;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5620756888558792"
            crossorigin="anonymous"></script>
</head>
<body class="antialiased">

    <div class="flex h-screen bg-gray-100 dark:bg-slate-900">
        <!-- Sidebar -->
        <aside id="sidebar" class="absolute md:relative z-20 flex-col w-64 bg-white dark:bg-slate-800 shadow-lg transition-transform duration-300 -translate-x-full md:translate-x-0">
            <div class="flex items-center justify-center h-20 border-b dark:border-slate-700 flex-shrink-0">
                <img src="https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png" alt="UPD Logo" class="w-12 h-12 object-contain">
                <h1 class="text-xl font-bold ml-2 text-slate-800 dark:text-white">UPD Portal</h1>
            </div>
            <nav class="flex-1 px-2 py-4 space-y-2 overflow-y-auto">
                <div>
                    <h3 class="px-3 text-xs uppercase text-slate-500 font-semibold tracking-wider">Core</h3>
                    <a href="index.html" class="mt-1 flex items-center px-3 py-2 text-slate-600 dark:text-slate-300 rounded-lg bg-slate-200 dark:bg-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                        <span class="ml-3">Dashboard</span>
                    </a>
                </div>
                <div class="pt-2">
                    <h3 class="px-3 text-xs uppercase text-slate-500 font-semibold tracking-wider">Resources</h3>
                    <a href="SOP.html" class="mt-1 flex items-center px-3 py-2 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span class="ml-3">SOPs</span>
                    </a>
                    <a href="training.html" class="mt-1 flex items-center px-3 py-2 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 14l9-5-9-5-9 5 9 5z"></path><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-9.998 12.078 12.078 0 01.665-6.479L12 14z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-9.998 12.078 12.078 0 01.665-6.479L12 14z"></path></svg>
                        <span class="ml-3">Training</span>
                    </a>
                </div>
                <div class="pt-2">
                    <h3 class="px-3 text-xs uppercase text-slate-500 font-semibold tracking-wider">Tools</h3>
                    <a href="forms.html" class="mt-1 flex items-center px-3 py-2 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                        <span class="ml-3">Forms</span>
                    </a>
                    <a href="report.html" class="mt-1 flex items-center px-3 py-2 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <span class="ml-3">Report Generator</span>
                    </a>
                    <a href="charges.html" class="mt-1 flex items-center px-3 py-2 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3.25a3.25 3.25 0 00-3.25-3.25H9.25A3.25 3.25 0 006 13.75V17m0 0h12M6 17H5a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-1m-6-14v2m-6-2v2"></path></svg>
                        <span class="ml-3">Charge Calculator</span>
                    </a>
                </div>
                <div class="pt-2">
                    <h3 class="px-3 text-xs uppercase text-slate-500 font-semibold tracking-wider">Personnel</h3>
                    <a href="roster.html" class="mt-1 flex items-center px-3 py-2 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.653-.124-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.653.124-1.283.356-1.857m0 0a3.001 3.001 0 015.644 0M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="ml-3">Roster</span>
                    </a>
                    <a href="hr.html" class="mt-1 flex items-center px-3 py-2 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 11a4 4 0 110-8 4 4 0 010 8z"></path></svg>
                        <span class="ml-3">HR Info</span>
                    </a>
                    <a href="info.html" class="mt-1 flex items-center px-3 py-2 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="ml-3">Common Information</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main content -->
        <div class="flex flex-col flex-1 overflow-hidden">
            <!-- Header -->
            <header class="bg-white dark:bg-slate-800 shadow-md flex items-center justify-between p-4 border-b dark:border-slate-700">
                <button id="hamburgerBtn" class="text-slate-500 focus:outline-none md:hidden">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
                <div class="flex-1"></div>
                <div class="flex items-center">
                    <button id="loginButton" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md hover:bg-blue-700 transition">Login</button>
                    <div id="userInfo" class="hidden items-center">
                        <p id="userEmail" class="mr-4 text-sm text-slate-600 dark:text-slate-300"></p>
                        <button id="logoutButton" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition">Logout</button>
                    </div>
                    <button id="settings-btn" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-500 transition-all ml-4">
                        <svg class="w-6 h-6 text-slate-600 dark:text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    </button>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto p-4 md:p-8">
                <!-- Hero Section -->
                <section class="relative bg-gray-900 text-white py-20 px-6 md:px-12 rounded-lg overflow-hidden shadow-xl mb-8">
                    <div class="background-video-container">
                        <video autoplay loop muted playsinline src="https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/c00b3c3ba71a061238ab2f7afd373dd0b597c0ad/index.mp4"></video>
                        <div class="video-overlay"></div>
                    </div>
                    <div class="relative z-10 text-center max-w-4xl mx-auto">
                        <h2 class="text-4xl md:text-6xl font-extrabold leading-tight mb-6">Empowering Our Officers</h2>
                        <p class="text-lg md:text-xl mb-8">Your central hub for UPD resources, policies, and departmental communications. Thank you for your service.</p>
                        <a href="SOP.html" class="inline-block bg-white text-blue-800 hover:bg-blue-100 font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">Access SOPs</a>
                    </div>
                </section>

                <!-- Quick Links -->
                <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Quick links will be dynamically generated here -->
                </section>

                <!-- Commitment Section -->
                <section class="bg-[var(--bg-secondary)] p-8 rounded-lg shadow-md mb-8">
                    <h2 class="text-3xl font-bold text-[var(--text-primary)] mb-6 text-center">Our Commitment to Our Team</h2>
                    <div class="flex flex-col md:flex-row items-center md:space-x-8">
                        <div class="md:w-2/3">
                            <p class="text-lg text-[var(--text-secondary)] leading-relaxed mb-4">The Unified Police Department is committed to providing our dedicated officers and staff with the resources, support, and training necessary to excel in their duties and maintain their well-being.</p>
                            <p class="text-lg text-[var(--text-secondary)] leading-relaxed mb-4">We foster an environment of continuous learning, mutual respect, and operational excellence, ensuring our team is equipped to uphold the highest standards of law enforcement and community service.</p>
                        </div>
                        <div class="md:w-1/3 mt-6 md:mt-0"><img src="https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png" alt="UPD Logo" class="rounded-lg shadow-md w-full h-auto object-contain"></div>
                    </div>
                </section>

                <!-- Dynamic Updates Section -->
                <section id="updatesSection" class="bg-[var(--bg-secondary)] p-8 rounded-lg shadow-md mb-8 hidden">
                    <h2 class="text-3xl font-bold text-[var(--text-primary)] mb-6 text-center">Recent Website Updates</h2>
                    <div id="updatesContent" class="space-y-4"></div>
                </section>

                <!-- Footer -->
                <footer class="bg-gray-800 text-white -mx-4 -mb-8 md:-mx-8 md:-mb-8 mt-8 py-10 px-6 md:px-12 rounded-t-lg"><div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8"><div><h4 class="text-xl font-semibold mb-4 text-blue-300">Internal Contacts</h4><ul class="space-y-2 text-sm"><li><a href="https://discord.gg/7FwxdpfDTM" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition">Discord</a></li><li><a href="#" class="text-gray-400 hover:text-white hover:underline transition">UPD Support</a></li><li><a href="#" class="text-gray-400 hover:text-white hover:underline transition">UPD Chat</a></li></ul></div><div><h4 class="text-xl font-semibold mb-4 text-blue-300">Quick Access</h4><ul class="space-y-2 text-sm"><li><a href="SOP.html" class="text-gray-400 hover:text-white hover:underline transition">UPD SOP</a></li><li><a href="training.html" class="text-gray-400 hover:text-white hover:underline transition">Training</a></li><li><a href="privacypolicy.html" class="text-gray-400 hover:text-white hover:underline transition">Privacy Policy</a></li></ul></div><div><h4 class="text-xl font-semibold mb-4 text-blue-300">System Information</h4><p class="text-gray-500 text-sm">&copy; 2025 Unified Police Department Internal Systems.</p></div></div></footer>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="loginModal" class="modal-overlay"><div class="modal-box"><h3 class="text-xl font-bold mb-4">Login</h3><div class="mb-4"><label for="emailInput" class="block text-sm font-semibold mb-2">Email</label><input type="email" id="emailInput" placeholder="Enter your email..." class="w-full px-4 py-2 border border-[var(--border-color)] bg-[var(--bg-tertiary)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)]"></div><div class="mb-4"><label for="passwordInput" class="block text-sm font-semibold mb-2">Password</label><input type="password" id="passwordInput" placeholder="Enter your password..." class="w-full px-4 py-2 border border-[var(--border-color)] bg-[var(--bg-tertiary)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)]"><p id="loginError" class="text-red-500 text-sm mt-1 hidden"></p></div><div class="flex justify-end space-x-4"><button id="cancelLoginBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition">Cancel</button><button id="submitLoginBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition">Login</button></div></div></div>
    <div id="settings-modal" class="modal-overlay"><div class="modal-box text-[var(--text-primary)]"><h2 class="text-2xl font-bold mb-6">Settings</h2><div class="mb-6"><h3 class="text-lg font-semibold mb-3">Website Theme</h3><div class="space-y-2"><label class="flex items-center"><input type="radio" name="theme" value="light" class="form-radio h-4 w-4 text-blue-600"><span class="ml-2">Light Mode</span></label><label class="flex items-center"><input type="radio" name="theme" value="dark" class="form-radio h-4 w-4 text-blue-600"><span class="ml-2">Dark Mode</span></label></div></div><div class="mb-6"><h3 class="text-lg font-semibold mb-3">Data Management</h3><div class="flex flex-col space-y-3"><button id="clear-data-btn" class="w-full bg-red-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition">Clear All Local Data</button><button id="view-data-btn" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">View Stored Data</button></div></div><div class="mt-8 text-right"><button id="close-settings-btn" class="bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 px-6 py-2 rounded-lg font-semibold hover:opacity-90 transition">Close</button></div></div></div>
    <div id="view-data-modal" class="modal-overlay"><div class="modal-box data-modal-box text-[var(--text-primary)]"><h2 class="text-2xl font-bold mb-4">Local Storage Data</h2><div id="data-container" class="space-y-4 text-sm"></div><div class="mt-6 text-right"><button id="close-view-data-btn" class="bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 px-6 py-2 rounded-lg font-semibold hover:opacity-90 transition">Close</button></div></div></div>
    <div id="confirm-modal" class="modal-overlay"><div class="modal-box text-[var(--text-primary)]"><h2 id="confirm-title" class="text-xl font-bold mb-4">Are you sure?</h2><p id="confirm-text" class="mb-6">This action cannot be undone.</p><div class="flex justify-end space-x-4"><button id="confirm-cancel-btn" class="bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 px-6 py-2 rounded-lg font-semibold hover:opacity-90 transition">Cancel</button><button id="confirm-ok-btn" class="bg-red-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-700 transition">Confirm</button></div></div></div>

    <script type="module">
        (() => {
            // --- CONFIGURATION ---
            const quickLinks = [
                { title: "Standard Operating Procedures", desc: "Latest departmental protocols and guidelines.", href: "SOP.html", linkText: "Browse SOPs" },
                { title: "Training & Development", desc: "Upcoming courses, certifications, and resources.", href: "training.html", linkText: "View Schedule" },
                { title: "Internal Forms & Requests", desc: "Access leave requests, equipment forms, and more.", href: "forms.html", linkText: "Download Forms" },
                { title: "Shift Roster & Schedules", desc: "Check your upcoming shifts and team assignments.", href: "roster.html", linkText: "View Roster" }
            ];

            // --- DOM ELEMENTS ---
            const sidebar = document.getElementById('sidebar');
            const settingsModal = document.getElementById('settings-modal');
            const themeRadios = document.querySelectorAll('input[name="theme"]');
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const loginButton = document.getElementById('loginButton');
            const logoutButton = document.getElementById('logoutButton');
            const userInfoDiv = document.getElementById('userInfo');
            const userEmailP = document.getElementById('userEmail');
            const settingsBtn = document.getElementById('settings-btn');
            const closeSettingsBtn = document.getElementById('close-settings-btn');
            const viewDataBtn = document.getElementById('view-data-btn');
            const clearDataBtn = document.getElementById('clear-data-btn');
            const viewDataModal = document.getElementById('view-data-modal');
            const closeViewDataBtn = document.getElementById('close-view-data-btn');
            const dataContainer = document.getElementById('data-container');
            const confirmModal = document.getElementById('confirm-modal');
            const confirmOkBtn = document.getElementById('confirm-ok-btn');
            const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
            const loginModal = document.getElementById('loginModal');
            const emailInput = document.getElementById('emailInput');
            const passwordInput = document.getElementById('passwordInput');
            const loginError = document.getElementById('loginError');
            const cancelLoginBtn = document.getElementById('cancelLoginBtn');
            const submitLoginBtn = document.getElementById('submitLoginBtn');


            // --- STATE ---
            let confirmCallback = null;

            // --- FUNCTIONS ---
            function generateQuickLinks() {
                const container = document.querySelector('.grid');
                container.innerHTML = quickLinks.map(link => `
                                    <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300">
                                        <h3 class="text-xl font-semibold text-[var(--accent-color)] mb-3">${link.title}</h3>
                                        <p class="text-[var(--text-secondary)] mb-4">${link.desc}</p>
                                        <a href="${link.href}" class="text-blue-500 dark:text-blue-400 hover:underline font-medium">${link.linkText} &rarr;</a>
                                    </div>
                                `).join('');
            }

            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    themeRadios.forEach(radio => radio.value === 'dark' ? radio.checked = true : false);
                } else {
                    document.documentElement.classList.remove('dark');
                    themeRadios.forEach(radio => radio.value === 'light' ? radio.checked = true : false);
                }
            };

            const updateLoginUI = (user) => {
                if (user) {
                    loginButton.classList.add('hidden');
                    userInfoDiv.classList.remove('hidden');
                    userInfoDiv.classList.add('flex');
                    userEmailP.textContent = user.email;
                } else {
                    loginButton.classList.remove('hidden');
                    userInfoDiv.classList.add('hidden');
                    userInfoDiv.classList.remove('flex');
                    userEmailP.textContent = '';
                }
            };


            const loadUpdates = async () => {
                const updatesSection = document.getElementById('updatesSection');
                const updatesContent = document.getElementById('updatesContent');
                const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQxN1ZQBPqwqLxvr_T1tQ2TVwHuy0d2jainTySsbsSxMBl6ukf5R3Di6SGO3sHA3CD-1uSBgp_qPtJA/pub?output=csv';
                const fourteenDaysAgo = new Date();
                fourteenDaysAgo.setDate(fourteenDaysAgo.getDate() - 14);

                try {
                    const response = await fetch(csvUrl);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const csvText = await response.text();
                    const lines = csvText.trim().split('\n');
                    const updates = [];

                    for (let i = 1; i < lines.length; i++) {
                        const parts = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                        if (parts.length >= 3) {
                            const dateStr = parts[0].trim().replace(/"/g, '');
                            const title = parts[1].trim().replace(/"/g, '');
                            const description = parts[2].trim().replace(/"/g, '');
                            const updateDate = new Date(dateStr);
                            if (!isNaN(updateDate) && updateDate >= fourteenDaysAgo) {
                                updates.push({ date: updateDate, title, description });
                            }
                        }
                    }
                    updates.sort((a, b) => b.date - a.date);
                    const recentUpdates = updates.slice(0, 10);

                    if (recentUpdates.length > 0) {
                        updatesContent.innerHTML = recentUpdates.map(update => `
                                            <div class="bg-[var(--bg-tertiary)] p-4 rounded-md">
                                                <p class="font-semibold">${update.date.toLocaleDateString()}: ${update.title}</p>
                                                <p class="text-sm text-[var(--text-secondary)]">${update.description}</p>
                                            </div>
                                        `).join('');
                        updatesSection.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Error fetching updates:', error);
                }
            };

            const sendDiscordLoadNotification = async () => {
                const webhookSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQxN1ZQBPqwqLxvr_T1tQ2TVwHuy0d2jainTySsbsSxMBl6ukf5R3Di6SGO3sHA3CD-1uSBgp_qPtJA/pub?gid=1211481486&single=true&output=csv';

                try {
                    const response = await fetch(webhookSheetUrl);
                    if (!response.ok) {
                        throw new Error(`Failed to fetch webhook sheet: ${response.status}`);
                    }
                    const csvText = await response.text();
                    const rows = csvText.trim().split('\n');
                    if (rows.length < 3) {
                        console.error("Webhook sheet does not have enough rows.");
                        return;
                    }
                    const cells = rows[2].split(',');
                    if (cells.length < 3) {
                        console.error("Row 3 of webhook sheet does not have enough columns.");
                        return;
                    }
                    const webhookUrl = cells[2].replace(/"/g, '').trim();

                    if (!webhookUrl || !webhookUrl.startsWith('https://discord.com/api/webhooks/')) {
                        console.error('Invalid or missing Discord webhook URL in cell C3.');
                        return;
                    }

                    const payload = {
                        username: "UPD Portal Bot",
                        avatar_url: "https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png",
                        embeds: [{
                            title: "Website Accessed",
                            description: "The UPD Internal Portal was just loaded by a user.",
                            color: 3447003,
                            timestamp: new Date().toISOString(),
                            footer: {
                                text: "UPD Internal Systems Notification"
                            }
                        }]
                    };

                    await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload),
                    });

                } catch (error) {
                    console.error('Error sending Discord notification:', error);
                }
            };


            // --- EVENT LISTENERS ---
            document.addEventListener('DOMContentLoaded', () => {
                generateQuickLinks();
                loadUpdates();
                sendDiscordLoadNotification();

                if (window.firebaseAuth) {
                    window.onAuthStateChanged(window.firebaseAuth, (user) => {
                        updateLoginUI(user);
                    });
                }


                const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
                applyTheme(savedTheme);

                themeRadios.forEach(radio => radio.addEventListener('change', (e) => {
                    localStorage.setItem('theme', e.target.value);
                    applyTheme(e.target.value);
                }));

                hamburgerBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    sidebar.classList.toggle('-translate-x-full');
                });

                loginButton.addEventListener('click', () => {
                    loginModal.classList.add('is-open');
                    emailInput.focus();
                });

                logoutButton.addEventListener('click', () => {
                    if (window.firebaseAuth) {
                        window.signOut(window.firebaseAuth).catch((error) => {
                            console.error('Sign Out Error', error);
                        });
                    }
                });

                settingsBtn.addEventListener('click', () => settingsModal.classList.add('is-open'));
                closeSettingsBtn.addEventListener('click', () => settingsModal.classList.remove('is-open'));

                viewDataBtn.addEventListener('click', () => {
                    dataContainer.innerHTML = '';
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        const value = localStorage.getItem(key);
                        const itemEl = document.createElement('div');
                        itemEl.className = 'p-3 bg-[var(--bg-tertiary)] rounded-md';
                        itemEl.innerHTML = `<strong class="text-[var(--accent-color)]">${key}:</strong><pre class="whitespace-pre-wrap break-all">${value}</pre>`;
                        dataContainer.appendChild(itemEl);
                    }
                    if (localStorage.length === 0) dataContainer.innerHTML = '<p>No local data found.</p>';
                    viewDataModal.classList.add('is-open');
                });
                closeViewDataBtn.addEventListener('click', () => viewDataModal.classList.remove('is-open'));

                clearDataBtn.addEventListener('click', () => {
                    openConfirmModal(() => {
                        Object.keys(localStorage).forEach(key => { if (key !== 'theme') localStorage.removeItem(key); });
                        location.reload();
                    });
                });

                const openConfirmModal = (callback) => { confirmCallback = callback; confirmModal.classList.add('is-open'); };
                const closeConfirmModal = () => { confirmModal.classList.remove('is-open'); confirmCallback = null; }
                confirmOkBtn.addEventListener('click', () => { if (confirmCallback) confirmCallback(); closeConfirmModal(); });
                confirmCancelBtn.addEventListener('click', closeConfirmModal);

                cancelLoginBtn.addEventListener('click', () => {
                    loginModal.classList.remove('is-open');
                    emailInput.value = '';
                    passwordInput.value = '';
                    loginError.classList.add('hidden');
                });

                submitLoginBtn.addEventListener('click', async () => {
                    const email = emailInput.value;
                    const password = passwordInput.value;
                    loginError.classList.add('hidden');
                    if (!email || !password) {
                        loginError.textContent = "Email and password are required.";
                        loginError.classList.remove('hidden');
                        return;
                    }

                    if (!window.firebaseAuth) {
                        loginError.textContent = "Firebase is not initialized. Please try again in a moment.";
                        loginError.classList.remove('hidden');
                        return;
                    }

                    try {
                        await window.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                        loginModal.classList.remove('is-open');
                        emailInput.value = '';
                        passwordInput.value = '';
                    } catch (error) {
                        console.error("Firebase Authentication Error:", error);
                        if (error.code === 'auth/operation-not-allowed') {
                            loginError.textContent = "Email/Password sign-in is not enabled. Please enable it in the Firebase console.";
                        } else {
                            loginError.textContent = "Invalid email or password. Please try again.";
                        }
                        loginError.classList.remove('hidden');
                    }
                });

            });
        })();
    </script>
    <script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
    <script>
        kofiWidgetOverlay.draw('tonydunkle', {
            'type': 'floating-chat',
            'floating-chat.donateButton.text': 'Support me',
            'floating-chat.donateButton.background-color': '#323842',
            'floating-chat.donateButton.text-color': '#fff'
        });
    </script>
</body>
</html>
