<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Viewport meta tag is crucial for responsive behavior across devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPD Internal Portal - Official Member Access</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="LSPD.png">

    <!-- Open Graph (Facebook, Discord, etc.) Meta Tags -->
    <!-- Updated og:title to display "Official Nightlife UPD Internal Web Portal" -->
    <meta property="og:title" content="Official Nightlife UPD Internal Web Portal">
    <meta property="og:description" content="Your central hub for Unified Police Department resources, policies, and departmental communications.">
    <!-- Use the direct raw GitHub URL for the image for consistent loading across platforms -->
    <meta property="og:image" content="https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png">
    <meta property="og:url" content="https://your-website-url.com/index.html"> <!-- IMPORTANT: Replace with your actual deployed URL -->
    <meta property="og:type" content="website">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <!-- Updated twitter:title to display "Official Nightlife UPD Internal Web Portal" -->
    <meta name="twitter:title" content="Official Nightlife UPD Internal Web Portal">
    <meta name="twitter:description" content="Your central hub for Unified Police Department resources, policies, and departmental communications.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png">

    <!-- Tailwind CSS CDN - provides responsive utility classes out of the box -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a clean, modern look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8; /* Light gray background */
            color: #333; /* Dark gray text */
            opacity: 0; /* Start with body invisible for fade-in */
            transition: opacity 1s ease-in; /* Smooth transition for fade-in */
        }

            body.fade-in {
                opacity: 1; /* Fade in to full visibility */
            }

            /* Light Mode */
            body.light-mode {
                background-color: #f8f8f8;
                color: #333;
            }

                body.light-mode .bg-blue-900 {
                    background-color: #1e3a8a; /* Darker blue for header */
                }

                body.light-mode .text-white {
                    color: #ffffff;
                }

                body.light-mode .bg-gradient-to-r {
                    background-image: linear-gradient(to right, #1e3a8a, #102a43); /* Darker blue gradient */
                }

                body.light-mode .bg-blue-50 {
                    background-color: #e0f2fe; /* Light blue */
                }

                body.light-mode .bg-gray-100 {
                    background-color: #f3f4f6;
                }

                body.light-mode .bg-white {
                    background-color: #ffffff;
                }

                body.light-mode .text-blue-700 {
                    color: #1d4ed8;
                }

                body.light-mode .text-blue-800 {
                    color: #1e40af;
                }

                body.light-mode .text-gray-800 {
                    color: #1f2937;
                }

                body.light-mode .text-gray-600 {
                    color: #4b5563;
                }

                body.light-mode .text-gray-700 {
                    color: #374151;
                }

                body.light-mode .text-blue-500 {
                    color: #3b82f6;
                }

                body.light-mode .bg-gray-800 {
                    background-color: #1f2937;
                }

                body.light-mode .text-blue-300 {
                    color: #93c5fd;
                }

                body.light-mode .text-gray-400 {
                    color: #9ca3af;
                }

                body.light-mode .text-gray-500 {
                    color: #6b7280;
                }

                /* Light mode input specific styles */
                body.light-mode input[type="text"],
                body.light-mode input[type="date"],
                body.light-mode input[type="time"],
                body.light-mode input[type="url"],
                body.light-mode select,
                body.light-mode textarea {
                    color: #1f2937; /* Dark gray text */
                    background-color: #ffffff; /* White background */
                }

                    body.light-mode input::placeholder,
                    body.light-mode textarea::placeholder {
                        color: #9ca3af; /* text-gray-400 */
                    }


            /* Dark Mode */
            body.dark-mode {
                background-color: #1a202c; /* bg-gray-900 */
                color: #e2e8f0; /* text-gray-200 */
            }

                body.dark-mode .bg-blue-900 {
                    background-color: #2d3748; /* Darker header */
                }

                body.dark-mode .text-white {
                    color: #e2e8f0;
                }

                body.dark-mode .bg-gradient-to-r {
                    background-image: linear-gradient(to right, #2d3748, #1a202c);
                }

                body.dark-mode .bg-blue-50 {
                    background-color: #2f3e58; /* Darker light blue */
                }

                body.dark-mode .bg-gray-100 {
                    background-color: #2d3748;
                }

                body.dark-mode .bg-white {
                    background-color: #2d3748;
                }

                body.dark-mode .text-blue-700 {
                    color: #90cdf4;
                }

                body.dark-mode .text-blue-800 {
                    color: #a7d9ff;
                }

                body.dark-mode .text-gray-800 {
                    color: #e2e8f0;
                }

                body.dark-mode .text-gray-600 {
                    color: #a0aec0;
                }

                body.dark-mode .text-gray-700 {
                    color: #cbd5e0;
                }

                body.dark-mode .text-blue-500 {
                    color: #63b3ed;
                }

                body.dark-mode .bg-gray-800 {
                    background-color: #1a202c;
                }

                body.dark-mode .text-blue-300 {
                    color: #90cdf4;
                }

                body.dark-mode .text-gray-400 {
                    color: #a0aec0;
                }

                body.dark-mode .text-gray-500 {
                    color: #cbd5e0;
                }

                body.dark-mode .shadow-lg,
                body.dark-mode .shadow-xl,
                body.dark-mode .shadow-inner {
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2);
                }

                body.dark-mode .modal-content {
                    background-color: #2d3748;
                }

                body.dark-mode .modal-overlay {
                    background-color: rgba(0, 0, 0, 0.8);
                }

                body.dark-mode .border {
                    border-color: #4a5568;
                }

                /* Dark mode specific footer styling for distinct separation */
                body.dark-mode footer {
                    border-top: 2px solid #4a5568; /* A subtle border for separation */
                    box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.5); /* Stronger shadow at the top */
                }

                /* Force input text color and background for dark mode */
                body.dark-mode input[type="text"],
                body.dark-mode input[type="date"],
                body.dark-mode input[type="time"],
                body.dark-mode input[type="url"],
                body.dark-mode select,
                body.dark-mode textarea {
                    color: #e2e8f0; /* Light gray text */
                    background-color: #4a5568; /* Darker gray background */
                    border-color: #6b7280; /* Slightly lighter border for visibility */
                }
                    /* Adjust placeholder color for dark mode inputs */
                    body.dark-mode input::placeholder,
                    body.dark-mode textarea::placeholder {
                        color: #a0aec0; /* Lighter gray for placeholder */
                    }


        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }

        body.dark-mode ::-webkit-scrollbar-track {
            background: #2d3748;
        }


        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: #555;
            }

        body.dark-mode ::-webkit-scrollbar-thumb {
            background: #a0aec0;
        }

            body.dark-mode ::-webkit-scrollbar-thumb:hover {
                background: #cbd5e0;
            }


        /* Styles for the banner */
        .banner-container {
            position: fixed;
            top: 4rem; /* Adjust based on header height */
            right: 1rem;
            z-index: 999; /* Ensure it's on top, but below the sticky header */
            max-width: 300px; /* Limit banner width */
            transform: translateX(100%); /* Start off-screen for slide-in */
            transition: transform 0.3s ease-in-out; /* Smooth transition for showing/hiding */
        }

            .banner-container.show {
                transform: translateX(0); /* Slide in */
            }

        .banner-content {
            background-color: #fff;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .banner-close-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
        }

            .banner-close-btn:hover {
                color: #333;
            }

        /* Style for the video player as a background */
        .background-video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0; /* Place behind content */
        }

            .background-video-container video {
                /* This ensures the video always covers the container, even if it means cropping */
                width: 100%;
                height: 100%;
                object-fit: cover; /* Ensures the video covers the entire area without distortion */
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%); /* Center the video */
            }

        /* Overlay for text readability */
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4); /* Semi-transparent dark overlay */
            z-index: 1; /* Above the video, below the text content */
        }

        /* Cookie Consent Banner Styles */
        #cookieConsentBanner {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #2d3748; /* bg-gray-800 */
            color: white;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000; /* Ensure it's on top of everything */
            transform: translateY(100%); /* Start off-screen */
            transition: transform 0.3s ease-in-out;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
        }

            #cookieConsentBanner.show {
                transform: translateY(0); /* Slide in */
            }

            #cookieConsentBanner p {
                margin-bottom: 1rem;
                text-align: center;
            }

            #cookieConsentBanner button {
                padding: 0.5rem 1rem;
                border-radius: 0.375rem; /* rounded-md */
                font-weight: 600; /* font-semibold */
                transition: background-color 0.2s ease-in-out;
            }

        #acceptCookies {
            background-color: #48bb78; /* bg-green-500 */
            color: white;
            margin-right: 0.5rem;
        }

            #acceptCookies:hover {
                background-color: #38a169; /* bg-green-600 */
            }

        #declineCookies {
            background-color: #f56565; /* bg-red-500 */
            color: white;
        }

            #declineCookies:hover {
                background-color: #e53e3e; /* bg-red-600 */
            }

        /* Login Button Styling */
        #loginButtonContainer {
            margin-top: 1rem; /* Space below nav */
            margin-left: 1rem; /* Align with left content */
            position: absolute; /* Position relative to header */
            top: 100%; /* Below the header */
            left: 0;
            z-index: 40; /* Below header, above main content */
        }

        #loginButton {
            background-color: #3182ce; /* bg-blue-600 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem; /* rounded-lg */
            font-weight: 700; /* font-bold */
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* shadow-md */
        }

            #loginButton:hover {
                background-color: #2b6cb0; /* bg-blue-700 */
                transform: translateY(-2px); /* Slight lift on hover */
            }

        /* Modal specific styles (copied from report.html) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-2xl */
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            width: 500px; /* Adjusted width for better readability */
        }

        .officer-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out;
        }

            .officer-item:hover {
                background-color: #f0f4f8; /* Light blue-gray hover */
            }

        /* Loading indicator styles (copied from report.html) */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Settings icon styles */
        #settingsIcon {
            width: 28px; /* Slightly larger icon */
            height: 28px;
            cursor: pointer;
            margin-left: 1.5rem; /* Space from navigation links */
            transition: transform 0.2s ease-in-out;
            filter: brightness(0) invert(1); /* Makes the icon white */
        }

            #settingsIcon:hover {
                transform: rotate(15deg);
            }

        body.dark-mode #settingsIcon {
            filter: none; /* Keep original color or adjust if necessary for dark mode */
        }

        /* Settings modal specific styles */
        #settingsModal .modal-content {
            width: 350px; /* Adjust width for settings modal */
        }

        #settingsModal .radio-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

            #settingsModal .radio-option input[type="radio"] {
                margin-right: 0.5rem;
            }

            #settingsModal .radio-option label {
                font-size: 1rem;
                color: #333;
            }

        body.dark-mode #settingsModal .radio-option label {
            color: #e2e8f0;
        }

        #settingsModal button {
            margin-top: 1rem;
            width: 100%;
        }

        /* Data Viewer Modal Styles */
        #dataViewerModal .modal-content {
            width: 600px;
            max-width: 95%;
        }

        #dataViewerContent {
            /* Removed pre-wrap and monospace for formatted list */
            background-color: #f4f4f4;
            border-radius: 0.5rem;
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }

        body.dark-mode #dataViewerContent {
            background-color: #1f2937;
            border-color: #4a5568;
            color: #e2e8f0;
        }

        /* Styles for data viewer items, similar to updates */
        .data-viewer-item {
            background-color: #ffffff;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 0.75rem;
        }

        body.dark-mode .data-viewer-item {
            background-color: #2d3748;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .data-viewer-item p {
            margin: 0;
            line-height: 1.5;
        }

        .data-viewer-item .title {
            font-weight: 600; /* font-semibold */
            color: #1f2937; /* text-gray-800 */
        }

        body.dark-mode .data-viewer-item .title {
            color: #e2e8f0;
        }

        .data-viewer-item .description {
            font-size: 0.875rem; /* text-sm */
            color: #4b5563; /* text-gray-600 */
        }

        body.dark-mode .data-viewer-item .description {
            color: #a0aec0;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Development Notice Banner -->
    <div id="devNoticeBanner" class="banner-container">
        <div class="banner-content">
            <button class="banner-close-btn" id="closeBannerBtn">&times;</button>
            <h3 class="text-lg font-bold text-blue-800 mb-2">Website Under Development</h3>
            <div class="flex items-center space-x-2">
                <img src="LSPD.png" alt="UPD Logo" class="w-10 h-10 object-contain" onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png';">
                <p class="text-gray-700 text-sm">
                    Some features may not work as expected or may be missing.
                </p>
            </div>
        </div>
    </div>

    <!-- Header Section -->
    <header class="bg-blue-900 text-white shadow-lg py-4 px-6 md:px-12 flex items-center justify-between sticky top-0 z-50 rounded-b-lg relative">
        <div class="flex items-center">
            <!-- UPD Logo -->
            <img src="LSPD.png" alt="UPD Logo" class="mr-4 w-16 h-16 object-contain" onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png';">
            <!-- Responsive font size: text-2xl for small screens, text-3xl for medium screens and up -->
            <h1 class="text-2xl md:text-3xl font-bold">Unified Police Department</h1>
        </div>

        <!-- Hamburger Menu Button for Mobile -->
        <button id="hamburgerBtn" class="hamburger-menu text-white focus:outline-none md:hidden">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-4 6h4"></path>
            </svg>
        </button>

        <!-- Navigation Menu -->
        <!-- Added md:flex-grow to nav to allow it to take available space -->
        <nav class="nav-links md:flex md:flex-grow md:justify-end">
            <!-- Changed md:space-x-8 to md:space-x-4 and added md:flex-wrap for stacking -->
            <ul class="flex flex-col md:flex-row md:flex-wrap md:justify-end space-y-2 md:space-y-0 md:space-x-4 text-sm font-medium">
                <li><a href="index.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Dashboard</a></li>
                <li><a href="SOP.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">SOPs</a></li>
                <li><a href="training.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Training</a></li>
                <li><a href="forms.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Forms</a></li>
                <li><a href="roster.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700 current-page">Roster</a></li>
                <li><a href="hr.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">HR Info</a></li>
                <li><a href="report.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Report Generator</a></li>
                <li><a href="charges.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Charge Calculator</a></li>
                <li><a href="info.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Common Information</a></li>
            </ul>
        </nav>
        <!-- Settings Icon -->
        <img src="settings.png" alt="Settings" id="settingsIcon" class="ml-4 cursor-pointer">
    </header>
    <!-- Hero Section - Internal Focus -->
    <section class="relative bg-gradient-to-r from-blue-700 to-blue-900 text-white py-20 px-6 md:px-12 rounded-lg m-4 md:m-8 overflow-hidden shadow-xl">
        <!-- Local Video Player for Background -->
        <div class="background-video-container">
            <video autoplay loop muted playsinline>
                <source src="index.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div class="video-overlay"></div> <!-- Overlay for readability -->
        </div>
        <div class="relative z-10 text-center max-w-4xl mx-auto">
            <h2 class="text-4xl md:text-6xl font-extrabold leading-tight mb-6">Empowering Our Officers</h2>
            <p class="text-lg md:text-xl mb-8">Your central hub for UPD resources, policies, and departmental communications. Thank you for your service.</p>
            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6">
                <!-- Updated SOP link in hero section -->
                <a href="SOP.html" class="inline-block bg-white text-blue-800 hover:bg-blue-100 font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">Access SOPs</a>
                <!-- Removed the "View Daily Briefing" button -->
            </div>
        </div>
    </section>

    <!-- Main Content Sections -->
    <main class="container mx-auto px-4 md:px-8 py-12">
        <!-- Internal Quick Links / Important Information -->
        <!-- Grid layout that changes columns based on screen size: 1 column on small, 2 on medium, 4 on large -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 ease-in-out">
                <h3 class="text-xl font-semibold text-blue-700 mb-3">Standard Operating Procedures</h3>
                <p class="text-gray-600 mb-4">Latest departmental protocols and guidelines.</p>
                <!-- Updated SOP quick link -->
                <a href="SOP.html" class="text-blue-500 hover:underline font-medium">Browse SOPs &rarr;</a>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 ease-in-out">
                <h3 class="text-xl font-semibold text-blue-700 mb-3">Training & Development</h3>
                <p class="text-gray-600 mb-4">Upcoming courses, certifications, and resources.</p>
                <!-- Updated Training quick link -->
                <a href="training.html" class="text-blue-500 hover:underline font-medium">View Schedule &rarr;</a>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 ease-in-out">
                <h3 class="text-xl font-semibold text-blue-700 mb-3">Internal Forms & Requests</h3>
                <p class="text-gray-600 mb-4">Access leave requests, equipment forms, and more.</p>
                <!-- Updated Forms quick link -->
                <a href="forms.html" class="text-blue-500 hover:underline font-medium">Download Forms &rarr;</a>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 ease-in-out">
                <h3 class="text-xl font-semibold text-blue-700 mb-3">Shift Roster & Schedules</h3>
                <p class="text-gray-600 mb-4">Check your upcoming shifts and team assignments.</p>
                <!-- Updated Roster quick link -->
                <a href="roster.html" class="text-blue-500 hover:underline font-medium">View Roster &rarr;</a>
            </div>
        </section>

        <!-- Our Internal Commitment / Values -->
        <section class="bg-blue-50 p-8 rounded-lg shadow-inner mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Our Commitment to Our Team</h2>
            <!-- Flexbox that stacks vertically on small screens and horizontally on medium screens and up -->
            <div class="flex flex-col md:flex-row items-center md:space-x-8">
                <div class="md:w-2/3">
                    <p class="text-lg text-gray-700 leading-relaxed mb-4">
                        The Unified Police Department is committed to providing our dedicated officers and staff with the resources, support, and training necessary to excel in their duties and maintain their well-being.
                    </p>
                    <p class="text-lg text-gray-700 leading-relaxed mb-4">
                        We foster an environment of continuous learning, mutual respect, and operational excellence, ensuring our team is equipped to uphold the highest standards of law enforcement and community service.
                    </p>
                </div>
                <div class="md:w-1/3 mt-6 md:mt-0">
                    <img src="LSPD.png" alt="UPD Logo" class="rounded-lg shadow-md w-full h-auto object-contain" onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png';">
                </div>
            </div>
        </section>

        <!-- Dynamic Updates Section -->
        <section id="updatesSection" class="bg-gray-100 p-8 rounded-lg shadow-lg mb-12 hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Recent Website Updates</h2>
            <div id="updatesContent" class="space-y-4">
                <!-- Updates will be loaded here dynamically from CSV -->
            </div>
        </section>

    </main>

    <!-- Footer Section - Internal Contacts -->
    <footer class="bg-gray-800 text-white py-10 px-6 md:px-12 rounded-t-lg">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <h4 class="text-xl font-semibold mb-4 text-blue-300">Internal Contacts</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="https://discord.gg/7FwxdpfDTM" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Discord</a></li>
                    <li><a href="https://discord.com/channels/1383775098464370768/1396398235660058685" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD Support</a></li>
                    <li><a href="https://discord.com/channels/1383775098464370768/1396398240840290374" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD Chat</a></li>
                    <li><a href="https://discord.com/channels/1383775098464370768/1396398235660058685" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD Internal Affairs</a></li>
                    <li><a href="https://discord.com/channels/1383775098464370768/1396398239678333030" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD Announcements</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-xl font-semibold mb-4 text-blue-300">Quick Access</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="https://docs.google.com/document/d/1etjilZ1dAHGviw33MV5Zs-b5dXqcSHyoYIHvHiRIyy4/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD SOP</a></li>
                    <li><a href="https://docs.google.com/document/d/1hKQ4fw9b1_yQELhPi1p1b4M6uiSaYb7bBp-9C6GVTdY/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Unified Police Department Interview Procedure & Questions</a></li>
                    <li><a href="https://docs.google.com/document/d/1d004FfAhZBgESn88Mx21N3CGqXlcoNeP9_sadn_ePak/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Promotional Pathway & Subdivision Assignment Policy</a></li>
                    <li><a href="https://docs.google.com/document/d/14QIEsYMWpTssti1xGbGWiMxQ2b0jbiYxuMmvV8XWUUo/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Highway Enforcement and Apprehension Team (HEAT) Activation Policy</a></li>
                    <li><a href="https://docs.google.com/document/d/1Ggf7SS5voiIjr3iSLB3VtAc47JN3aDjm2J_gYnpoZ6s/edit?blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Disciplinary Guidelines</a></li>
                    <li><a href="privacypolicy.html" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Privacy Policy</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-xl font-semibold mb-4 text-blue-300">System Information</h4>
                <p class="text-gray-500 text-sm mb-2">Unauthorized Access Strictly Prohibited</p>
                <p class="text-gray-500 text-sm mb-2">For UPD Personnel Use Only</p>
                <p class="text-500 text-sm mb-2">Created and Maintained by FiveM "NightLife RP"</p>
                <p class="text-gray-500 text-sm">&copy; 2025 Unified Police Department Internal Systems.</p>
            </div>
        </div>
        <!-- Font Awesome for any potential internal icons (though less needed here) -->
        <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    </footer>

    <!-- Cookie Consent Banner -->
    <div id="cookieConsentBanner" class="hidden">
        <p>This website uses cookies to enhance user experience. By continuing to use this site, you agree to our use of cookies. For more information, please see our <a href="privacypolicy.html" class="text-blue-300 hover:underline">Privacy Policy</a>.</p>
        <div class="flex">
            <button id="acceptCookies">Accept</button>
            <button id="declineCookies">Decline</button>
        </div>
    </div>

    <!-- Officer Selection Modal (Copied from report.html) -->
    <div id="officerSelectionModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Select Officer</h3>

            <!-- Department Selection for Login -->
            <div class="mb-4">
                <label for="loginDepartmentSelect" class="block text-gray-700 text-sm font-semibold mb-2">
                    Department
                </label>
                <select id="loginDepartmentSelect"
                        name="loginDepartmentSelect"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                    <option value="UPD">Unified Police Department</option>
                    <option value="LSCSO">Los Santos County Sheriff's Office</option>
                </select>
            </div>

            <input type="text"
                   id="officerSearchInput"
                   placeholder="Search officer name or badge..."
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
            <div id="officerList" class="max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-2 mb-4">
                <!-- Officer list will be populated here -->
                <div class="loader mx-auto my-4"></div> <!-- Loader for officer list -->
            </div>
            <div class="flex justify-end space-x-4">
                <button id="logoutButton"
                        class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md">
                    Logout
                </button>
                <button id="closeOfficerModalBtn"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Settings</h3>

            <div class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mb-2">Website Theme</h4>
                <div class="radio-option">
                    <input type="radio" id="lightMode" name="theme" value="light" class="text-blue-600">
                    <label for="lightMode">Light Mode</label>
                </div>
                <div class="radio-option">
                    <input type="radio" id="darkMode" name="theme" value="dark" class="text-blue-600">
                    <label for="darkMode">Dark Mode</label>
                </div>
            </div>

            <div class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mb-2">Data Management</h4>
                <button id="clearAllDataBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md w-full mb-2">
                    Clear All Local Data
                </button>
                <button id="viewDataBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md w-full">
                    View Stored Data
                </button>
            </div>

            <div class="flex justify-end mt-4">
                <button id="closeSettingsModalBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Data Viewer Modal -->
    <div id="dataViewerModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Local Storage Data</h3>
            <div id="dataViewerContent" class="space-y-4">
                <!-- Data will be loaded here dynamically -->
            </div>
            <div class="flex justify-end mt-4">
                <button id="closeDataViewerModalBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md">
                    Close
                </button>
            </div>
        </div>
    </div>


    <!-- Delete All Data Confirmation Modal (Now used by Clear All Local Data in Settings) -->
    <div id="confirmDeleteModal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Confirm Data Deletion</h3>
            <p class="text-gray-700 mb-6">
                Are you sure you want to completely delete ALL website data from your device?
                This includes login information, saved report data, and cookie preferences.
                This action cannot be undone.
            </p>
            <div class="flex justify-center space-x-4">
                <button id="confirmDeleteYesBtn"
                        class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md">
                    Yes, Delete All
                </button>
                <button id="confirmDeleteNoBtn"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md">
                    No, Keep Data
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Fade in the body content
            document.body.classList.add('fade-in');

            const banner = document.getElementById('devNoticeBanner');
            const closeBannerBtn = document.getElementById('closeBannerBtn');
            const cookieConsentBanner = document.getElementById('cookieConsentBanner');
            const acceptCookiesBtn = document.getElementById('acceptCookies');
            const declineCookiesBtn = document.getElementById('declineCookies');
            const loginButtonContainer = document.getElementById('loginButtonContainer');
            const loginButton = document.getElementById('loginButton');

            // Officer Selection Modal Elements
            const officerSelectionModal = document.getElementById('officerSelectionModal');
            const loginDepartmentSelect = document.getElementById('loginDepartmentSelect'); // NEW Department select for login
            const officerSearchInput = document.getElementById('officerSearchInput');
            const officerListDiv = document.getElementById('officerList');
            const closeOfficerModalBtn = document.getElementById('closeOfficerModalBtn');
            const logoutButton = document.getElementById('logoutButton'); // New logout button

            // Settings Modal Elements
            const settingsIcon = document.getElementById('settingsIcon');
            const settingsModal = document.getElementById('settingsModal');
            const closeSettingsModalBtn = document.getElementById('closeSettingsModalBtn');
            const lightModeRadio = document.getElementById('lightMode');
            const darkModeRadio = document.getElementById('darkMode');
            const clearAllDataBtn = document.getElementById('clearAllDataBtn');
            const viewDataBtn = document.getElementById('viewDataBtn');

            // Data Viewer Modal Elements
            const dataViewerModal = document.getElementById('dataViewerModal');
            const dataViewerContent = document.getElementById('dataViewerContent');
            const closeDataViewerModalBtn = document.getElementById('closeDataViewerModalBtn');


            // Delete All Data Confirmation Modal Elements
            const confirmDeleteModal = document.getElementById('confirmDeleteModal');
            const confirmDeleteYesBtn = document.getElementById('confirmDeleteYesBtn');
            const confirmDeleteNoBtn = document.getElementById('confirmDeleteNoBtn');


            // Global variable to store fetched officer roster data
            let officerRosterData = [];

            // Configuration for different department sheets (same as report.html)
            const departmentSheetConfig = {
                "LSPD": { // Renamed LSPD to UPD
                    sheetId: '2PACX-1vT8yueJjp9o-XVH1_RXPji6N_IAP1DDbNLZ8l4__IqGCvVEUWscsdsJ6uNHZ8u6kDhhXkSxcdkdeDJi', // Corrected LSPD sheetId
                    gid: '0',
                    rowRanges: [
                        { start: 6, end: 6 },
                        { start: 9, end: 16 },
                        { start: 18, end: 22 },
                        { start: 24, end: 27 },
                        { start: 29, end: 32 },
                        { start: 34, end: 43 },
                        { start: 45, end: 54 },
                        { start: 56, end: 65 },
                        { start: 67, end: 78 },
                        { start: 80, end: 96 },
                        { start: 98, end: 117 },
                        { start: 119, end: 148 }
                    ]
                },
                "LSCSO": {
                    sheetId: '2PACX-1vT8yueJjp9o-XVH1_RXPji6N_IAP1DDbNLZ8l4__IqGCvVEUWscsdsJ6uNHZ8u6kDhhXkSxcdkdeDJi',
                    gid: '1747285908',
                    rowRanges: null // Indicates generic filtering for this sheet
                }
            };


            // Show the development notice banner after a short delay
            setTimeout(() => {
                banner.classList.add('show');
            }, 500); // Adjust delay as needed

            // Function to hide the development notice banner
            const hideBanner = () => {
                banner.classList.remove('show'); // Hide by removing 'show' class
            };

            // Event listener for closing the development notice banner
            closeBannerBtn.addEventListener('click', hideBanner);

            /**
             * Converts an Excel-style column letter (e.g., 'A', 'B', 'AA') to a 0-based index.
             * @param {string} columnLetter - The column letter (e.g., 'C').
             * @returns {number} The 0-based column index (e.g., 'C' returns 2).
             */
            function columnLetterToIndex(columnLetter) {
                let index = 0;
                for (let i = 0; i < columnLetter.length; i++) {
                    index = index * 26 + (columnLetter.charCodeAt(i) - 'A'.charCodeAt(0) + 1);
                }
                return index - 1; // Convert to 0-based index
            }

            /**
             * Fetches CSV data from a Google Sheet, parses it, and populates the officerRosterData.
             * @param {string} department - The department for which to fetch the roster (e.g., "UPD", "LSCSO").
             */
            async function fetchAndSetOfficerRosterData(department) {
                officerListDiv.innerHTML = '<div class="loader mx-auto my-4"></div>'; // Show loader

                const config = departmentSheetConfig[department];
                if (!config) {
                    console.error(`Configuration not found for department: ${department}`);
                    officerListDiv.innerHTML = '<p class="text-red-500 text-center py-4">Department roster configuration missing.</p>';
                    officerRosterData = [];
                    return;
                }

                // Construct the CSV URL using the sheetId and gid
                const csvUrl = `https://docs.google.com/spreadsheets/d/e/${config.sheetId}/pub?gid=${config.gid}&single=true&output=csv`;

                try {
                    const response = await fetch(csvUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const csvText = await response.text();

                    const rawRows = csvText.trim().split('\n');
                    if (rawRows.length === 0) {
                        console.warn(`No roster data available for ${department} from Google Sheet.`);
                        officerRosterData = [];
                        officerListDiv.innerHTML = '<p class="text-gray-500 text-center py-4">No officers found for this department.</p>';
                        return;
                    }

                    const filteredRowsData = [];
                    // Regex to split by comma, ignoring commas inside double quotes
                    const regex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;

                    if (config.rowRanges) {
                        // Use specific row ranges if provided (e.g., for UPD)
                        const targetSpreadsheetRows = new Set();
                        config.rowRanges.forEach(range => {
                            for (let i = range.start; i <= range.end; i++) {
                                targetSpreadsheetRows.add(i);
                            }
                        });

                        rawRows.forEach((rowString, index) => {
                            const spreadsheetRowNumber = index + 1;
                            if (targetSpreadsheetRows.has(spreadsheetRowNumber)) {
                                const parsedCells = rowString.split(regex).map(cell => cell.replace(/^"(.*)"$/, '$1').trim());
                                filteredRowsData.push(parsedCells);
                            }
                        });
                    } else {
                        // Generic filtering for sheets without specific row ranges (e.g., LSCSO)
                        // Skip the first row (assuming it's a header) and filter out empty rows
                        const nameColIndex = columnLetterToIndex('D'); // Assuming 'D' for Name
                        const badgeColIndex = columnLetterToIndex('C'); // Assuming 'C' for Badge No.

                        rawRows.slice(1).forEach(rowString => { // Start from the second row
                            const parsedCells = rowString.split(regex).map(cell => cell.replace(/^"(.*)"$/, '$1').trim());
                            const name = parsedCells[nameColIndex] ? parsedCells[nameColIndex].trim() : '';
                            const badge = parsedCells[badgeColIndex] ? parsedCells[badgeColIndex].trim() : '';

                            // Only add if both name and badge are present and not 'N/A' or header-like strings
                            if (name && name !== 'N/A' && name.toLowerCase() !== 'name' && name.toLowerCase() !== 'full name' &&
                                badge && badge !== 'N/A' && badge.toLowerCase() !== 'badge no.' && badge.toLowerCase() !== 'badge number') {
                                filteredRowsData.push(parsedCells);
                            }
                        });
                    }

                    const headerToColIndexMap = {
                        'Badge No.': columnLetterToIndex('C'),
                        'Name': columnLetterToIndex('D'),
                    };

                    const tempOfficerRoster = [];
                    filteredRowsData.forEach(rowData => {
                        const name = rowData[headerToColIndexMap['Name']] ? rowData[headerToColIndexMap['Name']].trim() : '';
                        const badge = rowData[headerToColIndexMap['Badge No.']] ? rowData[headerToColIndexMap['Badge No.']].trim() : '';

                        // Only add if both name and badge are present and not 'N/A' or empty
                        if (name && name !== 'N/A' && badge && badge !== 'N/A') {
                            tempOfficerRoster.push({ name: name, badge: badge, department: department });
                        }
                    });
                    officerRosterData = tempOfficerRoster; // Update the global roster data
                    populateOfficerList(officerRosterData); // Populate the modal list with fetched data
                } catch (error) {
                    console.error(`Error fetching or parsing roster data for ${department}:`, error);
                    officerListDiv.innerHTML = `<p class="text-red-500 text-center py-4">Failed to load officer roster for ${department}. Please try again later.</p>`;
                }
            }

            // Function to populate the officer list in the modal
            function populateOfficerList(officers, searchTerm = '') {
                officerListDiv.innerHTML = ''; // Clear existing list
                const filteredOfficers = officers.filter(officer =>
                    officer.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    officer.badge.toLowerCase().includes(searchTerm.toLowerCase())
                );

                if (filteredOfficers.length === 0) {
                    officerListDiv.innerHTML = '<p class="text-gray-500 text-center py-4">No officers found.</p>';
                    return;
                }

                filteredOfficers.forEach(officer => {
                    const div = document.createElement('div');
                    div.className = 'officer-item p-2 rounded-md hover:bg-blue-100 cursor-pointer text-gray-800 text-sm font-medium';
                    div.textContent = `${officer.name} (${officer.badge})`;
                    div.dataset.name = officer.name;
                    div.dataset.badge = officer.badge;
                    div.dataset.department = officer.department; // Store department

                    div.addEventListener('click', () => {
                        localStorage.setItem('loggedInOfficer', JSON.stringify(officer));
                        updateLoginButton();
                        officerSelectionModal.classList.add('hidden');
                        console.log('Officer selected and saved to local storage:', officer);
                    });
                    officerListDiv.appendChild(div);
                });
            }

            // Function to update the login button text based on stored officer info
            const updateLoginButton = () => {
                const loggedInOfficer = localStorage.getItem('loggedInOfficer');
                if (loggedInOfficer) {
                    const officer = JSON.parse(loggedInOfficer);
                    loginButton.textContent = `Logged In: ${officer.name} (${officer.department})`; // Show department
                    loginButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    loginButton.classList.add('bg-green-600', 'hover:bg-green-700');
                } else {
                    loginButton.textContent = 'Login';
                    loginButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                    loginButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }
            };

            // --- Cookie Consent and Local Storage Logic ---

            // Function to enable local storage features
            const enableLocalStorageFeatures = () => {
                console.log('Local storage features enabled.');
                if (loginButtonContainer) {
                    loginButtonContainer.classList.remove('hidden');
                }
                updateLoginButton(); // Update login button state immediately
                // Add any other local storage dependent features here
            };

            // Function to disable local storage features
            const disableLocalStorageFeatures = () => {
                console.log('Local storage features disabled.');
                if (loginButtonContainer) {
                    loginButtonContainer.classList.add('hidden');
                }
                localStorage.removeItem('loggedInOfficer'); // Clear any stored login info
                updateLoginButton(); // Reset login button state
                // Hide or disable any other local storage dependent features here
            };

            // Function to check cookie consent status
            const checkCookieConsent = () => {
                const consent = localStorage.getItem('cookieConsent');
                if (consent === 'accepted') {
                    console.log('Cookie consent: Accepted. Enabling local storage features.');
                    enableLocalStorageFeatures();
                    cookieConsentBanner.classList.add('hidden'); // Hide banner if already accepted
                } else if (consent === 'declined') {
                    console.log('Cookie consent: Declined. Disabling local storage features.');
                    disableLocalStorageFeatures();
                    cookieConsentBanner.classList.add('hidden'); // Hide banner if declined
                } else {
                    console.log('Cookie consent: Not set. Showing banner.');
                    // Show the cookie banner after a slight delay to ensure other elements are loaded
                    setTimeout(() => {
                        cookieConsentBanner.classList.remove('hidden');
                        cookieConsentBanner.classList.add('show');
                    }, 1000);
                }
            };

            // Event listener for accepting cookies
            if (acceptCookiesBtn) {
                acceptCookiesBtn.addEventListener('click', () => {
                    localStorage.setItem('cookieConsent', 'accepted');
                    cookieConsentBanner.classList.remove('show');
                    setTimeout(() => {
                        cookieConsentBanner.classList.add('hidden');
                    }, 300); // Allow transition to finish before hiding completely
                    enableLocalStorageFeatures();
                    console.log('Cookies accepted.');
                });
            }

            // Event listener for declining cookies
            if (declineCookiesBtn) {
                declineCookiesBtn.addEventListener('click', () => {
                    localStorage.setItem('cookieConsent', 'declined');
                    localStorage.removeItem('loggedInOfficer'); // Clear login info if cookies declined
                    cookieConsentBanner.classList.remove('show');
                    setTimeout(() => {
                        cookieConsentBanner.classList.add('hidden');
                    }, 300); // Allow transition to finish before hiding completely
                    disableLocalStorageFeatures();
                    console.log('Cookies declined.');
                });
            }

            // Initial check for cookie consent when the page loads
            checkCookieConsent();

            // Event listener for Login Button
            if (loginButton) {
                loginButton.addEventListener('click', async () => {
                    officerSelectionModal.classList.remove('hidden');
                    officerSearchInput.value = ''; // Clear search input
                    officerListDiv.innerHTML = '<div class="loader mx-auto my-4"></div>'; // Show loader inside modal

                    // Set initial department in login modal based on logged-in officer or default
                    const loggedInOfficer = localStorage.getItem('loggedInOfficer');
                    let initialLoginDepartment = 'UPD'; // Changed default to UPD
                    if (loggedInOfficer) {
                        try {
                            const officer = JSON.parse(loggedInOfficer);
                            initialLoginDepartment = officer.department || 'UPD'; // Changed default to UPD
                        } catch (e) {
                            console.error('Error parsing loggedInOfficer from localStorage:', e);
                        }
                    }
                    loginDepartmentSelect.value = initialLoginDepartment;

                    await fetchAndSetOfficerRosterData(initialLoginDepartment); // Fetch and populate for the initial department
                });
            }

            // Event listener for department change in login modal
            loginDepartmentSelect.addEventListener('change', async (e) => {
                const selectedDepartment = e.target.value;
                officerSearchInput.value = ''; // Clear search when department changes
                await fetchAndSetOfficerRosterData(selectedDepartment);
            });

            // Officer Search Input Listener
            officerSearchInput.addEventListener('input', (e) => {
                populateOfficerList(officerRosterData, e.target.value);
            });

            // Close Officer Modal Button
            if (closeOfficerModalBtn) {
                closeOfficerModalBtn.addEventListener('click', () => {
                    officerSelectionModal.classList.add('hidden');
                });
            }

            // Logout Button
            if (logoutButton) {
                logoutButton.addEventListener('click', () => {
                    localStorage.removeItem('loggedInOfficer');
                    updateLoginButton(); // Reset button text
                    officerSelectionModal.classList.add('hidden');
                    console.log('Logged out. Officer data cleared from local storage.');
                });
            }

            // Close officer modal when clicking outside of it
            officerSelectionModal.addEventListener('click', (e) => {
                if (e.target === officerSelectionModal) {
                    officerSelectionModal.classList.add('hidden');
                }
            });


            // --- Theme Switching Logic ---
            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.body.classList.remove('light-mode');
                    if (darkModeRadio) darkModeRadio.checked = true; // Ensure radio button is checked
                } else {
                    document.body.classList.remove('dark-mode');
                    document.body.classList.add('light-mode');
                    if (lightModeRadio) lightModeRadio.checked = true; // Ensure radio button is checked
                }
                localStorage.setItem('theme', theme);
            };

            // Initialize theme based on local storage or default to light
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);

            if (lightModeRadio) {
                lightModeRadio.addEventListener('change', () => applyTheme('light'));
            }
            if (darkModeRadio) {
                darkModeRadio.addEventListener('change', () => applyTheme('dark'));
            }

            // --- Settings Modal Logic ---
            if (settingsIcon) {
                settingsIcon.addEventListener('click', () => {
                    settingsModal.classList.remove('hidden');
                    // Ensure correct radio button is checked when opening modal
                    const currentTheme = localStorage.getItem('theme') || 'light';
                    if (currentTheme === 'dark') {
                        darkModeRadio.checked = true;
                    } else {
                        lightModeRadio.checked = true;
                    }
                });
            }

            if (closeSettingsModalBtn) {
                closeSettingsModalBtn.addEventListener('click', () => {
                    settingsModal.classList.add('hidden');
                });
            }

            if (settingsModal) {
                settingsModal.addEventListener('click', (e) => {
                    if (e.target === settingsModal) {
                        settingsModal.classList.add('hidden');
                    }
                });
            }

            // --- Clear All Data Logic (now inside settings modal) ---
            if (clearAllDataBtn) {
                clearAllDataBtn.addEventListener('click', () => {
                    settingsModal.classList.add('hidden'); // Hide settings modal first
                    confirmDeleteModal.classList.remove('hidden'); // Show confirmation modal
                });
            }

            if (confirmDeleteYesBtn) {
                confirmDeleteYesBtn.addEventListener('click', () => {
                    localStorage.clear(); // Clears all data from local storage for this domain
                    console.log('All website data cleared from local storage.');
                    confirmDeleteModal.classList.add('hidden');
                    location.reload(); // Reload the page to reflect changes
                });
            }

            if (confirmDeleteNoBtn) {
                confirmDeleteNoBtn.addEventListener('click', () => {
                    confirmDeleteModal.classList.add('hidden');
                    settingsModal.classList.remove('hidden'); // Show settings modal again
                });
            }

            // Close delete confirmation modal if clicking outside
            if (confirmDeleteModal) {
                confirmDeleteModal.addEventListener('click', (e) => {
                    if (e.target === confirmDeleteModal) {
                        confirmDeleteModal.classList.add('hidden');
                        settingsModal.classList.remove('hidden'); // Show settings modal again
                    }
                });
            }


            // --- Data Viewer Logic ---
            if (viewDataBtn) {
                viewDataBtn.addEventListener('click', () => {
                    settingsModal.classList.add('hidden'); // Hide settings modal
                    dataViewerModal.classList.remove('hidden');
                    displayLocalStorageData();
                });
            }

            if (closeDataViewerModalBtn) {
                closeDataViewerModalBtn.addEventListener('click', () => {
                    dataViewerModal.classList.add('hidden');
                    settingsModal.classList.remove('hidden'); // Show settings modal again
                });
            }

            if (dataViewerModal) {
                dataViewerModal.addEventListener('click', (e) => {
                    if (e.target === dataViewerModal) {
                        dataViewerModal.classList.add('hidden');
                        settingsModal.classList.remove('hidden'); // Show settings modal again
                    }
                });
            }

            function displayLocalStorageData() {
                dataViewerContent.innerHTML = ''; // Clear existing content

                let hasData = false;

                // Display Logged In Officer
                const loggedInOfficer = localStorage.getItem('loggedInOfficer');
                if (loggedInOfficer) {
                    try {
                        const officer = JSON.parse(loggedInOfficer);
                        const officerDiv = document.createElement('div');
                        officerDiv.className = 'data-viewer-item';
                        officerDiv.innerHTML = `
                                                        <p class="title">Officer Logged In</p>
                                                        <p class="description">${officer.name} (Badge: ${officer.badge}, Department: ${officer.department || 'N/A'})</p>
                                                    `;
                        dataViewerContent.appendChild(officerDiv);
                        hasData = true;
                    } catch (e) {
                        console.error("Error parsing loggedInOfficer from local storage:", e);
                    }
                }

                // Display Website Theme
                const currentTheme = localStorage.getItem('theme');
                if (currentTheme) {
                    const themeDiv = document.createElement('div');
                    themeDiv.className = 'data-viewer-item';
                    themeDiv.innerHTML = `
                                                    <p class="title">Website Theme</p>
                                                    <p class="description">${currentTheme.charAt(0).toUpperCase() + currentTheme.slice(1)} Mode</p>
                                                `;
                    dataViewerContent.appendChild(themeDiv);
                    hasData = true;
                }

                // Display Other Stored Data
                let otherDataCount = 0;
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    // Skip keys already displayed
                    if (key === 'loggedInOfficer' || key === 'theme' || key === 'cookieConsent' || key === 'reportGeneratorData') { // Added reportGeneratorData
                        continue;
                    }

                    let value;
                    try {
                        // Try to parse as JSON, otherwise keep as string
                        value = JSON.parse(localStorage.getItem(key));
                        // If it's an object/array, stringify it nicely
                        if (typeof value === 'object' && value !== null) {
                            value = JSON.stringify(value, null, 2);
                        }
                    } catch (e) {
                        value = localStorage.getItem(key);
                    }

                    if (otherDataCount === 0) {
                        const otherDataHeader = document.createElement('div');
                        otherDataHeader.className = 'data-viewer-item mt-4';
                        otherDataHeader.innerHTML = `<p class="title">Other Stored Data</p>`;
                        dataViewerContent.appendChild(otherDataHeader);
                    }

                    const dataDiv = document.createElement('div');
                    dataDiv.className = 'data-viewer-item';
                    dataDiv.innerHTML = `
                                                    <p class="title">${key}</p>
                                                    <p class="description">${value}</p>
                                                `;
                    dataViewerContent.appendChild(dataDiv);
                    hasData = true;
                    otherDataCount++;
                }

                if (!hasData) {
                    dataViewerContent.innerHTML = '<p class="text-gray-500 text-center py-4">No user-specific data currently stored in local storage.</p>';
                }
            }


            // Function to fetch and display updates from CSV
            const loadUpdates = async () => {
                const updatesSection = document.getElementById('updatesSection');
                const updatesContent = document.getElementById('updatesContent');
                // Updated CSV URL to the new link provided by the user, ensuring it outputs as CSV
                const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQxN1ZQBPqwqLxvr_T1tQ2TVwHuy0d2jainTySsbsSxMBl6ukf5R3Di6SGO3sHA3CD-1uSBgp_qPtJA/pub?output=csv';
                const fourteenDaysAgo = new Date();
                fourteenDaysAgo.setDate(fourteenDaysAgo.getDate() - 14);

                console.log('--- Starting loadUpdates ---');
                console.log('Current Date:', new Date().toLocaleDateString());
                console.log('14 Days Ago Date:', fourteenDaysAgo.toLocaleDateString());

                try {
                    const response = await fetch(csvUrl);
                    console.log('Fetch response status:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const csvText = await response.text();
                    console.log('Fetched CSV Text (first 200 chars):', csvText.substring(0, 200));

                    // Simple CSV parsing (assuming format: Date,Type,Description)
                    const lines = csvText.trim().split('\n');
                    const updates = [];

                    console.log('Total CSV lines (including header):', lines.length);

                    // Skip header row
                    for (let i = 1; i < lines.length; i++) {
                        const parts = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); // Split by comma, but not inside quotes
                        console.log(`Processing line ${i}:`, parts);

                        if (parts.length >= 3) {
                            // Remove leading/trailing quotes from date and description
                            const dateStr = parts[0].trim().replace(/"/g, '');
                            const title = parts[1].trim().replace(/"/g, ''); // Also remove quotes from title
                            const description = parts[2].trim().replace(/"/g, '');

                            const updateDate = new Date(dateStr);

                            console.log(`Date string (cleaned): "${dateStr}", Parsed Date:`, updateDate);
                            console.log('Is Date Valid (isNaN):', isNaN(updateDate));
                            console.log('Is updateDate >= fourteenDaysAgo:', updateDate >= fourteenDaysAgo);

                            // Check if the date is valid and within the last 14 days
                            if (!isNaN(updateDate) && updateDate >= fourteenDaysAgo) {
                                updates.push({ date: updateDate, title, description });
                                console.log('Update added:', { date: updateDate, title, description });
                            } else {
                                console.log('Update skipped (invalid date or too old):', { dateStr, title });
                            }
                        } else {
                            console.log('Skipping malformed line (less than 3 parts):', lines[i]);
                        }
                    }

                    // Sort updates by date in descending order (most recent first)
                    updates.sort((a, b) => b.date - a.date);

                    // Limit to 10 updates
                    const recentUpdates = updates.slice(0, 10);
                    console.log('Number of recent updates after filtering and slicing:', recentUpdates.length);
                    console.log('Recent Updates Array:', recentUpdates);

                    updatesContent.innerHTML = ''; // Clear existing content

                    if (recentUpdates.length > 0) {
                        recentUpdates.forEach(update => {
                            const updateDiv = document.createElement('div');
                            updateDiv.className = 'bg-white p-4 rounded-md shadow-sm';
                            updateDiv.innerHTML = `
                                                                    <p class="text-gray-800 font-semibold">${update.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}: ${update.title}</p>
                                                                    <p class="text-gray-600 text-sm">${update.description}</p>
                                                                `;
                            updatesContent.appendChild(updateDiv);
                        });
                        updatesSection.classList.remove('hidden'); // Show the section
                        console.log('Updates section is now visible.');
                    } else {
                        updatesSection.classList.add('hidden'); // Hide the section if no recent updates
                        console.log('No recent updates found. Updates section is hidden.');
                    }

                } catch (error) {
                    console.error('Error fetching or parsing updates CSV:', error);
                    updatesSection.classList.add('hidden'); // Hide the section on error
                }
                console.log('--- Finished loadUpdates ---');
            };

            // Load updates when the page loads
            loadUpdates();
        });
    </script>
</body>
</html>
