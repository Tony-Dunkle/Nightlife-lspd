<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Viewport meta tag is crucial for responsive behavior across devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Police Report Generator</title>
    <!-- Favicon link updated with a fallback URL for robustness -->
    <link rel="icon" type="image/png" href="LSPD.png" onerror="this.href='https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png';">
    <!-- Tailwind CSS CDN - provides responsive utility classes out of the out of the box -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF CDN for generating PDF documents -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Custom font for a clean, modern look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8; /* Light gray background */
            color: #333; /* Dark gray text */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: #555;
            }

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-2xl */
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            width: 500px; /* Adjusted width for better readability */
        }

        .evidence-item, .officer-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out;
        }

            .evidence-item:hover, .officer-item:hover {
                background-color: #f0f4f8; /* Light blue-gray hover */
            }

            .evidence-item input[type="checkbox"] {
                margin-right: 0.75rem;
                width: 1.25rem;
                height: 1.25rem;
            }

        .evidence-description {
            margin-top: 0.5rem;
            font-size: 0.875rem; /* text-sm */
            color: #6b7280; /* text-gray-500 */
            min-height: 1.5rem; /* To prevent layout shift when description appears */
        }

        /* Loading indicator styles */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Header Section -->
    <header class="bg-blue-900 text-white shadow-lg py-4 px-6 md:px-12 flex items-center justify-between sticky top-0 z-50 rounded-b-lg relative">
        <div class="flex items-center">
            <!-- LSPD Logo -->
            <img src="LSPD.png" alt="LSPD Logo" class="mr-4 w-16 h-16 object-contain" onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png';">
            <!-- Responsive font size: text-2xl for small screens, text-3xl for medium screens and up -->
            <h1 class="text-2xl md:text-3xl font-bold">Los Santos Police Department</h1>
        </div>

        <!-- Hamburger Menu Button for Mobile -->
        <button id="hamburgerBtn" class="hamburger-menu text-white focus:outline-none md:hidden">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-4 6h4"></path>
            </svg>
        </button>

        <!-- Navigation Menu -->
        <!-- Added md:flex-grow to nav to allow it to take available space -->
        <nav class="nav-links md:flex md:flex-grow md:justify-end">
            <!-- Changed md:space-x-8 to md:space-x-4 and added md:flex-wrap for stacking -->
            <ul class="flex flex-col md:flex-row md:flex-wrap md:justify-end space-y-2 md:space-y-0 md:space-x-4 text-sm font-medium">
                <li><a href="index.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700 current-page">Dashboard</a></li>
                <li><a href="SOP.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">SOPs</a></li>
                <li><a href="training.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Training</a></li>
                <li><a href="forms.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Forms</a></li>
                <li><a href="roster.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Roster</a></li>
                <li><a href="hr.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">HR Info</a></li>
                <li><a href="report.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Report Generator</a></li>
                <li><a href="charges.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Charge Calculator</a></li>
                <li><a href="info.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Common Information</a></li>
            </ul>
        </nav>
    </header>
    <!-- Main Content Section -->
    <main class="w-full px-4 md:px-8 py-12 flex justify-center items-start">
        <!-- Police Report Generator Section -->
        <section class="bg-blue-50 p-8 rounded-lg shadow-inner w-full">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Police Report Generator</h2>
            <div class="bg-white p-8 rounded-xl shadow-2xl w-full">

                <!-- Department Dropdown -->
                <div class="mb-6">
                    <label for="department" class="block text-gray-700 text-sm font-semibold mb-2">
                        Department
                    </label>
                    <select id="department"
                            name="department"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                        <option value="LSPD">Los Santos Police Department</option>
                        <option value="LSCSO">Los Santos County Sheriff's Office</option>
                    </select>
                </div>

                <!-- Report Type Dropdown -->
                <div class="mb-6">
                    <label for="reportType" class="block text-gray-700 text-sm font-semibold mb-2">
                        Report Type
                    </label>
                    <select id="reportType"
                            name="reportType"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                        <option value="Arrest Report">Arrest Report</option>
                        <option value="Traffic Citation">Traffic Citation</option>
                        <option value="Use of Force">Use of Force</option>
                        <option value="Trespass Notice">Trespass Notice</option>
                        <option value="Business Incident">Business Incident</option>
                        <option value="Incident Report">Incident Report</option> <!-- New Incident Report Option -->
                    </select>
                </div>

                <!-- Officer Name and Badge Number (Common for all reports) - Now clickable -->
                <div class="mb-6">
                    <label for="officerInfo" class="block text-gray-700 text-sm font-semibold mb-2">
                        Officer Name and Badge Number
                    </label>
                    <input type="text"
                           id="officerInfo"
                           name="officerInfo"
                           placeholder="Click to select officer..."
                           readonly
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800 cursor-pointer">
                </div>

                <!-- Arrest Report Fields -->
                <div id="arrestReportFields" class="report-fields">
                    <!-- Text Box 2: Suspect First and Last Name -->
                    <div class="mb-6">
                        <label for="suspectName" class="block text-gray-700 text-sm font-semibold mb-2">
                            Suspect First and Last Name
                        </label>
                        <input type="text"
                               id="suspectName"
                               name="suspectName"
                               placeholder="Enter suspect's first and last name"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>

                    <!-- Text Box 3: Charges -->
                    <div class="mb-6">
                        <label for="charges" class="block text-gray-700 text-sm font-semibold mb-2">
                            Charges
                        </label>
                        <input type="text"
                               id="charges"
                               name="charges"
                               placeholder="Enter charges (e.g., Theft, Assault)"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>

                    <!-- Mirandized Dropdown -->
                    <div class="mb-6">
                        <label for="mirandized" class="block text-gray-700 text-sm font-semibold mb-2">
                            Mirandized (Required)
                        </label>
                        <select id="mirandized"
                                name="mirandized"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                            <option value="">Select an option</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>

                    <!-- GSR Test Dropdown -->
                    <div class="mb-6">
                        <label for="gsrTest" class="block text-gray-700 text-sm font-semibold mb-2">
                            GSR Test (Required)
                        </label>
                        <select id="gsrTest"
                                name="gsrTest"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                            <option value="">Select an option</option>
                            <option value="positive">Positive</option>
                            <option value="negative">Negative</option>
                            <option value="N/A">N/A</option>
                        </select>
                    </div>

                    <!-- Name of Legal Representation -->
                    <div class="mb-6">
                        <label for="legalRepresentation" class="block text-gray-700 text-sm font-semibold mb-2">
                            Name of Legal Representation (leave blank if none present)
                        </label>
                        <input type="text"
                               id="legalRepresentation"
                               name="legalRepresentation"
                               placeholder="Enter legal representation name"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>

                    <!-- Level of Force Dropdown -->
                    <div class="mb-6">
                        <label for="levelOfForce" class="block text-gray-700 text-sm font-semibold mb-2">
                            Level of Force
                        </label>
                        <select id="levelOfForce"
                                name="levelOfForce"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                            <option value="">Select Level of Force</option>
                            <option value="Level 1 Officer Presence">A) Level 1 Officer Presence — No force is used. Considered the best way to resolve a situation.</option>
                            <option value="Level 2 Verbalization">B) Level 2 Verbalization — Force is not-physical.</option>
                            <option value="Level 3 Empty-Hand Control">C) Level 3 Empty-Hand Control — Officers use bodily force to gain control of a situation.</option>
                            <option value="Level 4 Less-Lethal Methods">D) Level 4 Less-Lethal Methods — Officers use less-lethal technologies to gain control of a situation.</option>
                            <option value="Level 5 Lethal Force">E) Level 5 Lethal Force — Officers use lethal weapons to gain control of a situation. It should only be used if a suspect poses a serious threat to the officer or another individual.</option>
                        </select>
                    </div>

                    <!-- Medical Treatment Dropdown -->
                    <div class="mb-6">
                        <label for="medicalTreatment" class="block text-gray-700 text-sm font-semibold mb-2">
                            Medical Treatment
                        </label>
                        <select id="medicalTreatment"
                                name="medicalTreatment"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                            <option value="">Select an option</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>

                    <!-- Plea Type Dropdown -->
                    <div class="mb-6">
                        <label for="pleaType" class="block text-gray-700 text-sm font-semibold mb-2">
                            Plea Type:
                        </label>
                        <select id="pleaType"
                                name="pleaType"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                            <option value="">Select Plea Type</option>
                            <option value="guilty">Guilty</option>
                            <option value="not guilty">Not Guilty</option>
                            <option value="no contest">No Contest</option>
                            <option value="N/A">N/A</option>
                        </select>
                    </div>

                    <!-- Officer Narrative (Specific to Arrest Report) -->
                    <div class="mb-6">
                        <label for="arrestNarrative" class="block text-gray-700 text-sm font-semibold mb-2">
                            Officer Narrative
                        </label>
                        <textarea id="arrestNarrative"
                                  name="arrestNarrative"
                                  rows="5"
                                  placeholder="Enter officer narrative here..."
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                </div>

                <!-- Traffic Citation Fields -->
                <div id="trafficCitationFields" class="report-fields hidden">
                    <div class="mb-6">
                        <label for="driverName" class="block text-gray-700 text-sm font-semibold mb-2">
                            Driver's Full Name
                        </label>
                        <input type="text" id="driverName" name="driverName" placeholder="Enter driver's full name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="driverLicense" class="block text-gray-700 text-sm font-semibold mb-2">
                            Driver's License Number
                        </label>
                        <input type="text" id="driverLicense" name="driverLicense" placeholder="Enter driver's license number" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="vehicleMakeModel" class="block text-gray-700 text-sm font-semibold mb-2">
                            Vehicle Make/Model
                        </label>
                        <input type="text" id="vehicleMakeModel" name="vehicleMakeModel" placeholder="Enter vehicle make and model" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="vehiclePlate" class="block text-gray-700 text-sm font-semibold mb-2">
                            Vehicle Plate Number
                        </label>
                        <input type="text" id="vehiclePlate" name="vehiclePlate" placeholder="Enter vehicle plate number" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="violation" class="block text-gray-700 text-sm font-semibold mb-2">
                            Violation
                        </label>
                        <input type="text" id="violation" name="violation" placeholder="e.g., Speeding, Red Light Violation" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="citationLocation" class="block text-gray-700 text-sm font-semibold mb-2">
                            Location of Violation
                        </label>
                        <input type="text" id="citationLocation" name="citationLocation" placeholder="Enter location of violation" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="citationNarrative" class="block text-gray-700 text-sm font-semibold mb-2">
                            Officer Narrative
                        </label>
                        <textarea id="citationNarrative" name="citationNarrative" rows="5" placeholder="Describe the circumstances of the violation..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                </div>

                <!-- Use of Force Fields -->
                <div id="useOfForceFields" class="report-fields hidden">
                    <div class="mb-6">
                        <label for="subjectName" class="block text-gray-700 text-sm font-semibold mb-2">
                            Subject's Full Name
                        </label>
                        <input type="text" id="subjectName" name="subjectName" placeholder="Enter subject's full name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="uofLevelOfForce" class="block text-gray-700 text-sm font-semibold mb-2">
                            Level of Force Used
                        </label>
                        <select id="uofLevelOfForce" name="uofLevelOfForce" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                            <option value="">Select Level of Force</option>
                            <option value="Level 1 Officer Presence">A) Level 1 Officer Presence — No force is used. Considered the best way to resolve a situation.</option>
                            <option value="Level 2 Verbalization">B) Level 2 Verbalization — Force is not-physical.</option>
                            <option value="Level 3 Empty-Hand Control">C) Level 3 Empty-Hand Control — Officers use bodily force to gain control of a situation.</option>
                            <option value="Level 4 Less-Lethal Methods">D) Level 4 Less-Lethal Methods — Officers use less-lethal technologies to gain control of a situation.</option>
                            <option value="Level 5 Lethal Force">E) Level 5 Lethal Force — Officers use lethal weapons to gain control of a situation. It should only be used if a suspect poses a serious threat to the officer or another individual.</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label for="uofReason" class="block text-gray-700 text-sm font-semibold mb-2">
                            Reason for Use of Force
                        </label>
                        <textarea id="uofReason" name="uofReason" rows="3" placeholder="Explain why force was necessary" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="uofInjuries" class="block text-gray-700 text-sm font-semibold mb-2">
                            Injuries Sustained (Officer/Subject)
                        </label>
                        <textarea id="uofInjuries" name="uofInjuries" rows="3" placeholder="Describe any injuries sustained by officer or subject" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="uofMedicalTreatment" class="block text-gray-700 text-sm font-semibold mb-2">
                            Medical Treatment Provided/Requested
                        </label>
                        <select id="uofMedicalTreatment" name="uofMedicalTreatment" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                            <option value="">Select an option</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label for="uofNarrative" class="block text-gray-700 text-sm font-semibold mb-2">
                            Officer Narrative
                        </label>
                        <textarea id="uofNarrative" name="uofNarrative" rows="5" placeholder="Enter detailed narrative of the incident leading to use of force..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                </div>

                <!-- Trespass Notice Fields -->
                <div id="trespassNoticeFields" class="report-fields hidden">
                    <div class="mb-6">
                        <label for="trespasserName" class="block text-gray-700 text-sm font-semibold mb-2">
                            Trespasser's Full Name
                        </label>
                        <input type="text" id="trespasserName" name="trespasserName" placeholder="Enter trespasser's full name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="trespassLocation" class="block text-gray-700 text-sm font-semibold mb-2">
                            Property Address
                        </label>
                        <input type="text" id="trespassLocation" name="trespassLocation" placeholder="Enter property address where trespass occurred" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="propertyOwner" class="block text-gray-700 text-sm font-semibold mb-2">
                            Property Owner/Manager Name
                        </label>
                        <input type="text" id="propertyOwner" name="propertyOwner" placeholder="Enter property owner/manager name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="trespassReason" class="block text-gray-700 text-sm font-semibold mb-2">
                            Reason for Trespass Notice
                        </label>
                        <textarea id="trespassReason" name="trespassReason" rows="3" placeholder="Describe the reason for issuing the trespass notice" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="trespassDuration" class="block text-gray-700 text-sm font-semibold mb-2">
                            Duration of Ban
                        </label>
                        <input type="text" id="trespassDuration" name="trespassDuration" placeholder="e.g., Permanent, 1 year, Until further notice" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="trespassNarrative" class="block text-gray-700 text-sm font-semibold mb-2">
                            Officer Narrative
                        </label>
                        <textarea id="trespassNarrative" name="trespassNarrative" rows="5" placeholder="Enter detailed narrative of the incident..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                </div>

                <!-- Business Incident Fields -->
                <div id="businessIncidentFields" class="report-fields hidden">
                    <div class="mb-6">
                        <label for="businessName" class="block text-gray-700 text-sm font-semibold mb-2">
                            Business Name
                        </label>
                        <input type="text" id="businessName" name="businessName" placeholder="Enter business name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="businessAddress" class="block text-gray-700 text-sm font-semibold mb-2">
                            Business Address
                        </label>
                        <input type="text" id="businessAddress" name="businessAddress" placeholder="Enter business address" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="incidentType" class="block text-gray-700 text-sm font-semibold mb-2">
                            Type of Incident
                        </label>
                        <input type="text" id="incidentType" name="incidentType" placeholder="e.g., Shoplifting, Vandalism, Disturbance" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="involvedParties" class="block text-gray-700 text-sm font-semibold mb-2">
                            Involved Parties (Names/Roles)
                        </label>
                        <textarea id="involvedParties" name="involvedParties" rows="3" placeholder="List names and roles of involved parties (e.g., Victim, Suspect, Witness)" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="damagesTheft" class="block text-gray-700 text-sm font-semibold mb-2">
                            Damages/Theft Description
                        </label>
                        <textarea id="damagesTheft" name="damagesTheft" rows="3" placeholder="Describe any damages or items stolen" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="bizNarrative" class="block text-gray-700 text-sm font-semibold mb-2">
                            Officer Narrative
                        </label>
                        <textarea id="bizNarrative" name="bizNarrative" rows="5" placeholder="Enter detailed narrative of the business incident..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                </div>

                <!-- Incident Report Fields (NEW) -->
                <div id="incidentReportFields" class="report-fields hidden">
                    <div class="mb-6">
                        <label for="incidentLocation" class="block text-gray-700 text-sm font-semibold mb-2">
                            Location of Incident
                        </label>
                        <input type="text" id="incidentLocation" name="incidentLocation" placeholder="Enter location of incident" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="incidentDate" class="block text-gray-700 text-sm font-semibold mb-2">
                            Date of Incident
                        </label>
                        <input type="date" id="incidentDate" name="incidentDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="incidentTime" class="block text-gray-700 text-sm font-semibold mb-2">
                            Time of Incident
                        </label>
                        <input type="time" id="incidentTime" name="incidentTime" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="primaryIncidentType" class="block text-gray-700 text-sm font-semibold mb-2">
                            Primary Incident Type
                        </label>
                        <input type="text" id="primaryIncidentType" name="primaryIncidentType" placeholder="e.g., Theft, Assault, Vandalism, Missing Person" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800">
                    </div>
                    <div class="mb-6">
                        <label for="affectedParties" class="block text-gray-700 text-sm font-semibold mb-2">
                            Affected Parties (Names/Roles)
                        </label>
                        <textarea id="affectedParties" name="affectedParties" rows="3" placeholder="List names and roles of affected parties (e.g., Victim, Witness, Reporting Party)" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="incidentDescription" class="block text-gray-700 text-sm font-semibold mb-2">
                            Incident Description
                        </label>
                        <textarea id="incidentDescription" name="incidentDescription" rows="5" placeholder="Provide a detailed description of the incident, including what happened, when, where, and who was involved." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="actionsTaken" class="block text-gray-700 text-sm font-semibold mb-2">
                            Actions Taken by Officer
                        </label>
                        <textarea id="actionsTaken" name="actionsTaken" rows="3" placeholder="Describe the actions taken by the officer(s) at the scene (e.g., interviewed witnesses, secured scene, referred to detective)." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                    </div>
                </div>

                <!-- Evidence Collected (New Section) -->
                <div class="mb-6">
                    <label for="evidenceCollectedInput" class="block text-gray-700 text-sm font-semibold mb-2">
                        Evidence Collected (Click to select)
                    </label>
                    <input type="text"
                           id="evidenceCollectedInput"
                           name="evidenceCollectedInput"
                           readonly
                           placeholder="Click to select evidence..."
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800 cursor-pointer">
                </div>

                <!-- Conditional Text Areas for Statements -->
                <div id="victimStatementsContainer" class="mb-6 hidden">
                    <label for="victimStatementsText" class="block text-gray-700 text-sm font-semibold mb-2">
                        Victim Statements Details
                    </label>
                    <textarea id="victimStatementsText"
                              name="victimStatementsText"
                              rows="3"
                              placeholder="Enter details of victim statements..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                </div>

                <div id="witnessStatementsContainer" class="mb-6 hidden">
                    <label for="witnessStatementsText" class="block text-gray-700 text-sm font-semibold mb-2">
                        Witness Statements Details
                    </label>
                    <textarea id="witnessStatementsText"
                              name="witnessStatementsText"
                              rows="3"
                              placeholder="Enter details of witness statements..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                </div>

                <div id="suspectStatementsContainer" class="mb-6 hidden">
                    <label for="suspectStatementsText" class="block text-gray-700 text-sm font-semibold mb-2">
                        Suspect Statements/Confessions Details
                    </label>
                    <textarea id="suspectStatementsText"
                              name="suspectStatementsText"
                              rows="3"
                              placeholder="Enter details of suspect statements/confessions..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y placeholder-gray-400 text-gray-800"></textarea>
                </div>


                <!-- Text Area: Generated Report -->
                <div class="mb-6 relative">
                    <label for="generatedReport" class="block text-gray-700 text-sm font-semibold mb-2">
                        Generated Report
                    </label>
                    <div class="absolute top-0 right-0 mt-2 mr-2 flex space-x-2">
                        <button type="button"
                                id="copyReportBtn"
                                class="bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-1 px-3 rounded-lg shadow-md transition duration-200 ease-in-out hidden"
                                title="Copy report to clipboard">
                            Copy Report
                        </button>
                        <button type="button"
                                id="downloadReportBtn"
                                class="bg-green-500 hover:bg-green-600 text-white text-xs font-bold py-1 px-3 rounded-lg shadow-md transition duration-200 ease-in-out hidden"
                                title="Download report as PDF">
                            Download Report
                        </button>
                        <!-- NEW: View Report Button -->
                        <button type="button"
                                id="viewReportBtn"
                                class="bg-purple-500 hover:bg-purple-600 text-white text-xs font-bold py-1 px-3 rounded-lg shadow-md transition duration-200 ease-in-out hidden"
                                title="View report in new tab">
                            View Report
                        </button>
                    </div>
                    <textarea id="generatedReport"
                              name="generatedReport"
                              rows="10"
                              readonly
                              placeholder="Your generated report will appear here..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm resize-y text-gray-800 pt-10"></textarea>
                </div>

                <!-- Submit Button -->
                <div class="mt-8">
                    <button type="button"
                            id="generateReportBtn"
                            class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:from-blue-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-300 ease-in-out shadow-md">
                        Generate Report
                    </button>
                </div>

                <!-- Loading Indicator for AI Generation -->
                <div id="loadingIndicator" class="hidden text-center text-blue-600 mt-4 font-semibold">
                    Generating report... Please wait.
                </div>
            </div>
        </section>
    </main>

    <!-- Officer Selection Modal -->
    <div id="officerSelectionModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Select Officer</h3>
            <input type="text"
                   id="officerSearchInput"
                   placeholder="Search officer name or badge..."
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
            <div id="officerList" class="max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-2 mb-4">
                <!-- Officer list will be populated here -->
                <div class="loader mx-auto my-4"></div> <!-- Loader for officer list -->
            </div>
            <div class="flex justify-end space-x-4">
                <button id="closeOfficerModalBtn"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Evidence Selection Modal -->
    <div id="evidenceModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Select Evidence Collected</h3>
            <div id="evidenceList" class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4">
                <!-- Evidence items will be populated here by JavaScript -->
            </div>
            <div id="evidenceDescriptionDisplay" class="evidence-description text-gray-600 mb-4">
                Hover over an item for more details.
            </div>
            <button id="closeEvidenceModalBtn"
                    class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md">
                Close
            </button>
        </div>
    </div>

    <!-- URL Input Modal -->
    <div id="urlInputModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-gray-800 mb-4" id="urlModalTitle">Add Link</h3>
            <p class="text-gray-600 text-sm mb-4" id="allowedProvidersText"></p>
            <input type="url"
                   id="evidenceUrlInput"
                   name="evidenceUrlInput"
                   placeholder="Enter URL here..."
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out shadow-sm placeholder-gray-400 text-gray-800 mb-2">
            <p id="urlValidationError" class="text-red-600 text-sm mb-4 hidden"></p>
            <div id="currentLinksDisplay" class="mb-4 text-sm text-gray-700">
                <!-- Added links will appear here -->
            </div>
            <div class="flex justify-end space-x-4">
                <button id="addUrlBtn"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md">
                    Add Link
                </button>
                <button id="closeUrlModalBtn"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out shadow-md">
                    Done
                </button>
            </div>
        </div>
    </div>


    <!-- Footer Section - Internal Contacts -->
    <!-- Grid layout that changes columns based on screen size: 1 column on small, 3 on medium screens and up -->
    <footer class="bg-gray-800 text-white py-10 px-6 md:px-12 rounded-t-lg">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Internal Contact Info (content removed, titles remain) -->
            <div>
                <h4 class="text-xl font-semibold mb-4 text-blue-300">Internal Contacts</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="https://discord.gg/7FwxdpfDTM" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Discord</a></li>
                    <li><a href="https://discord.com/channels/1383775098464370768/1383775099777318972" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD Chat</a></li>
                    <li><a href="https://discord.com/channels/1383775098464370768/1383782578976456735" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Cadet Support</a></li>
                </ul>
            </div>
            <!-- Internal Quick Links (text links added) -->
            <div>
                <h4 class="text-xl font-semibold mb-4 text-blue-300">Quick Access</h4>
                <ul class="space-y-2 text-sm">
                    <!-- Added text-sm here -->
                    <li><a href="https://docs.google.com/document/d/1etjilZ1dAHGviw33MV5Zs-b5dXqcSHyoYIHvHiRIyy4/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">LSPD SOP</a></li>
                    <li><a href="https://docs.google.com/document/d/1hKQ4fw9b1_yQELhPi1p1b4M6uiSaYb7bBp-9C6GVTdY/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Los Santos Police Department Interview Procedure & Questions</a></li>
                    <li><a href="https://docs.google.com/document/d/1d004FfAhZBgESn88Mx21N3CGqXlcoNeP9_sadn_ePak/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Promotional Pathway & Subdivision Assignment Policy</a></li>
                    <li><a href="https://docs.google.com/document/d/14QIEsYMWpTssti1xGbGWiMxQ2b0jbiYxuMmvV8XWUUo/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Highway Enforcement and Apprehension Team (HEAT) Activation Policy</a></li>
                    <li><a href="https://docs.google.com/document/d/1Ggf7SS5voiIjr3iSLB3VtAc47JN3aDjm2J_gYnpoZ6s/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Disciplinary Guidelines</a></li>
                    <li><a href="https://nlspd.net/" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">LSPD Website</a></li>
                </ul>
            </div>
            <!-- Copyright & Internal System Info (content removed, titles remain) -->
            <div>
                <h4 class="text-xl font-semibold mb-4 text-blue-300">System Information</h4>
                <p class="text-gray-500 text-sm mb-2">Unauthorized Access Strictly Prohibited</p>
                <p class="text-gray-500 text-sm mb-2">For LSPD Personnel Use Only</p>
                <p class="text-500 text-sm mb-2">Created and Maintained by FiveM "NightLife RP"</p>
                <p class="text-gray-500 text-sm">&copy; 2025 Los Santos Police Department Internal Systems.</p>
            </div>
        </div>
        <!-- Font Awesome for any potential internal icons (though less needed here) -->
        <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    </footer>

    <script>
        // Get references to common elements
        const departmentSelect = document.getElementById('department');
        const reportTypeSelect = document.getElementById('reportType');
        const officerInfoInput = document.getElementById('officerInfo'); // Common officer info field
        const generatedReportTextarea = document.getElementById('generatedReport');
        const generateReportBtn = document.getElementById('generateReportBtn');
        const copyReportBtn = document.getElementById('copyReportBtn');
        const downloadReportBtn = document.getElementById('downloadReportBtn'); // NEW Download Report Button
        const viewReportBtn = document.getElementById('viewReportBtn'); // NEW View Report Button
        const loadingIndicator = document.getElementById('loadingIndicator');

        // Get references to report-specific field containers
        const arrestReportFields = document.getElementById('arrestReportFields');
        const trafficCitationFields = document.getElementById('trafficCitationFields');
        const useOfForceFields = document.getElementById('useOfForceFields');
        const trespassNoticeFields = document.getElementById('trespassNoticeFields');
        const businessIncidentFields = document.getElementById('businessIncidentFields');
        const incidentReportFields = document.getElementById('incidentReportFields'); // NEW Incident Report Fields

        // Get references to Arrest Report specific elements
        const suspectNameInput = document.getElementById('suspectName');
        const chargesInput = document.getElementById('charges');
        const arrestNarrativeTextarea = document.getElementById('arrestNarrative'); // Renamed from 'narrative'
        const mirandizedSelect = document.getElementById('mirandized');
        const gsrTestSelect = document.getElementById('gsrTest');
        const legalRepresentationInput = document.getElementById('legalRepresentation');
        const levelOfForceSelect = document.getElementById('levelOfForce');
        const medicalTreatmentSelect = document.getElementById('medicalTreatment');
        const pleaTypeSelect = document.getElementById('pleaType');

        // Get references to Traffic Citation specific elements
        const driverNameInput = document.getElementById('driverName');
        const driverLicenseInput = document.getElementById('driverLicense');
        const vehicleMakeModelInput = document.getElementById('vehicleMakeModel');
        const vehiclePlateInput = document.getElementById('vehiclePlate');
        const violationInput = document.getElementById('violation');
        const citationLocationInput = document.getElementById('citationLocation');
        const citationNarrativeTextarea = document.getElementById('citationNarrative');

        // Get references to Use of Force specific elements
        const subjectNameInput = document.getElementById('subjectName');
        const uofLevelOfForceSelect = document.getElementById('uofLevelOfForce');
        const uofReasonTextarea = document.getElementById('uofReason');
        const uofInjuriesTextarea = document = document.getElementById('uofInjuries');
        const uofMedicalTreatmentSelect = document.getElementById('uofMedicalTreatment');
        const uofNarrativeTextarea = document.getElementById('uofNarrative');

        // Get references to Trespass Notice specific elements
        const trespasserNameInput = document.getElementById('trespasserName');
        const trespassLocationInput = document.getElementById('trespassLocation');
        const propertyOwnerInput = document.getElementById('propertyOwner');
        const trespassReasonTextarea = document.getElementById('trespassReason');
        const trespassDurationInput = document.getElementById('trespassDuration');
        const trespassNarrativeTextarea = document.getElementById('trespassNarrative');

        // Get references to Business Incident specific elements
        const businessNameInput = document.getElementById('businessName');
        const businessAddressInput = document.getElementById('businessAddress');
        const incidentTypeInput = document.getElementById('incidentType');
        const involvedPartiesTextarea = document.getElementById('involvedParties');
        const damagesTheftTextarea = document.getElementById('damagesTheft');
        const bizNarrativeTextarea = document.getElementById('bizNarrative');

        // Get references to Incident Report specific elements (NEW)
        const incidentLocationInput = document.getElementById('incidentLocation');
        const incidentDateInput = document.getElementById('incidentDate');
        const incidentTimeInput = document.getElementById('incidentTime');
        const primaryIncidentTypeInput = document.getElementById('primaryIncidentType');
        const affectedPartiesTextarea = document.getElementById('affectedParties');
        const incidentDescriptionTextarea = document.getElementById('incidentDescription');
        const actionsTakenTextarea = document.getElementById('actionsTaken');


        // Evidence Collection Elements
        const evidenceCollectedInput = document.getElementById('evidenceCollectedInput');
        const evidenceModal = document.getElementById('evidenceModal');
        const closeEvidenceModalBtn = document.getElementById('closeEvidenceModalBtn');
        const evidenceListDiv = document.getElementById('evidenceList');
        const evidenceDescriptionDisplay = document.getElementById('evidenceDescriptionDisplay');

        // Conditional Statement Text Areas
        const victimStatementsContainer = document.getElementById('victimStatementsContainer');
        const victimStatementsTextarea = document.getElementById('victimStatementsText');
        const witnessStatementsContainer = document.getElementById('witnessStatementsContainer');
        const witnessStatementsTextarea = document.getElementById('witnessStatementsText');
        const suspectStatementsContainer = document.getElementById('suspectStatementsContainer');
        const suspectStatementsTextarea = document.getElementById('suspectStatementsText');

        // URL Input Modal Elements
        const urlInputModal = document.getElementById('urlInputModal');
        const urlModalTitle = document.getElementById('urlModalTitle');
        const allowedProvidersText = document.getElementById('allowedProvidersText');
        const evidenceUrlInput = document.getElementById('evidenceUrlInput');
        const urlValidationError = document.getElementById('urlValidationError');
        const currentLinksDisplay = document.getElementById('currentLinksDisplay');
        const addUrlBtn = document.getElementById('addUrlBtn');
        const closeUrlModalBtn = document.getElementById('closeUrlModalBtn');

        // Officer Selection Modal Elements
        const officerSelectionModal = document.getElementById('officerSelectionModal');
        const officerSearchInput = document.getElementById('officerSearchInput');
        const officerListDiv = document.getElementById('officerList');
        const closeOfficerModalBtn = document.getElementById('closeOfficerModalBtn');

        // Global object to store selected evidence and their details (including links/text)
        let selectedEvidenceDetails = {};

        // Global variable to store fetched officer roster data
        let officerRosterData = [];

        /**
         * Converts an Excel-style column letter (e.g., 'A', 'B', 'AA') to a 0-based index.
         * @param {string} columnLetter - The column letter (e.g., 'C').
         * @returns {number} The 0-based column index (e.g., 'C' returns 2).
         */
        function columnLetterToIndex(columnLetter) {
            let index = 0;
            for (let i = 0; i < columnLetter.length; i++) {
                index = index * 26 + (columnLetter.charCodeAt(i) - 'A'.charCodeAt(0) + 1);
            }
            return index - 1; // Convert to 0-based index
        }

        /**
         * Fetches CSV data from a Google Sheet, parses it, and populates the officerRosterData.
         * This function is called when the officer selection modal is opened.
         */
        async function fetchAndSetOfficerRosterData() {
            officerListDiv.innerHTML = '<div class="loader mx-auto my-4"></div>'; // Show loader

            const sheetId = '1o4Xw8GSQBp6brMfGo_ubYngnhWJU_f8AhyUIftAlT1Y';
            const gid = '0'; // Assuming gid=0 for the primary sheet tab
            const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`;

            try {
                const response = await fetch(csvUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();

                const rawRows = csvText.trim().split('\n');
                if (rawRows.length === 0) {
                    console.warn('No roster data available from Google Sheet.');
                    officerRosterData = []; // Ensure it's empty
                    officerListDiv.innerHTML = '<p class="text-gray-500 text-center py-4">No officers found.</p>';
                    return;
                }

                // Define the target spreadsheet row numbers (1-indexed)
                const targetSpreadsheetRows = new Set();
                const addRange = (start, end) => {
                    for (let i = start; i <= end; i++) {
                        targetSpreadsheetRows.add(i);
                    }
                };

                targetSpreadsheetRows.add(6);
                targetSpreadsheetRows.add(9);
                targetSpreadsheetRows.add(10);
                targetSpreadsheetRows.add(11);
                addRange(12, 16);
                addRange(18, 22);
                addRange(24, 27);
                addRange(29, 32);
                addRange(34, 43);
                addRange(45, 54);
                addRange(56, 65);
                addRange(67, 78);
                addRange(80, 96);
                addRange(98, 117);
                addRange(119, 148);

                const filteredRowsData = [];
                const regex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/; // Regex to split by comma, ignoring commas in double quotes

                rawRows.forEach((rowString, index) => {
                    const spreadsheetRowNumber = index + 1; // CSV rows are 0-indexed, spreadsheet rows are 1-indexed
                    if (targetSpreadsheetRows.has(spreadsheetRowNumber)) {
                        // Parse each cell, removing quotes if present
                        const parsedCells = rowString.split(regex).map(cell => cell.replace(/^"(.*)"$/, '$1').trim());
                        filteredRowsData.push(parsedCells);
                    }
                });

                // Define the mapping from desired fields to their original column indices
                const headerToColIndexMap = {
                    'Badge No.': columnLetterToIndex('C'),
                    'Name': columnLetterToIndex('D'),
                };

                const tempOfficerRoster = [];
                filteredRowsData.forEach(rowData => {
                    const name = rowData[headerToColIndexMap['Name']] ? rowData[headerToColIndexMap['Name']].trim() : '';
                    const badge = rowData[headerToColIndexMap['Badge No.']] ? rowData[headerToColIndexMap['Badge No.']].trim() : '';

                    // Only add if both name and badge are present and not 'N/A' or empty
                    if (name && name !== 'N/A' && badge && badge !== 'N/A') {
                        tempOfficerRoster.push({ name: name, badge: badge });
                    }
                });
                officerRosterData = tempOfficerRoster; // Update the global roster data
                populateOfficerList(officerRosterData); // Populate the modal list with fetched data
            } catch (error) {
                console.error('Error fetching or parsing roster data:', error);
                officerListDiv.innerHTML = '<p class="text-red-500 text-center py-4">Failed to load officer roster. Please try again later.</p>';
            }
        }


        // Array of evidence items with descriptions, types, and allowed link providers
        const evidenceItems = [
            { name: "Shell Casings", description: "Spent ammunition casings found at a scene.", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "Weapon(s) - Firearm", description: "Any type of gun, pistol, rifle, shotgun, etc.", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "Weapon(s) - Non-Firearm", description: "Knives, bats, blunt objects, tasers, etc.", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "Contraband", description: "Any item not allowed to be possessed by law (e.g., illegal paraphernalia, stolen goods).", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "Controlled Substances", description: "Illegal drugs or unprescribed medication (e.g., Methamphetamine, Cocaine, Marijuana).", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "Fingerprints", description: "Latent or visible prints lifted from surfaces.", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "DNA Evidence", description: "Biological samples such as blood, hair, saliva, skin cells.", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "Clothing/Personal Items", description: "Garments or personal belongings relevant to the incident.", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "Vehicular Evidence", description: "Vehicle parts, fluids, tire marks, paint transfers, etc.", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "Photographs/Videos (Other)", description: "Still images or video recordings not from body/dash cam (e.g., from civilian phones).", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "Electronic Devices", description: "Phones, computers, tablets, USB drives, memory cards.", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },
            { name: "Documents", description: "Papers, identification cards, financial records, written notes.", type: "image", linkProviders: ["fivemanage.com", "imgur.com", "discord.com"] },

            { name: "CCTV Footage", description: "Video recordings from surveillance cameras.", type: "video", linkProviders: ["discord.com", "medal.tv", "youtube.com"] },
            { name: "Body Cam Footage", description: "Video recordings from officer-worn body cameras.", type: "video", linkProviders: ["discord.com", "medal.tv", "youtube.com"] },
            { name: "Dashcam Footage", description: "Video recordings from patrol vehicle dashboard cameras.", type: "video", linkProviders: ["discord.com", "medal.tv", "youtube.com"] },
            { name: "Audio Recordings", description: "Voice recordings, 911 calls, dispatch recordings, etc.", type: "video", linkProviders: ["discord.com", "medal.tv", "youtube.com"] },

            { name: "Victim Statements", description: "Written or recorded accounts from individuals who were harmed or affected.", type: "statement" },
            { name: "Witness Statements", description: "Written or recorded accounts from individuals observing the incident.", type: "statement" },
            { name: "Suspect Statements/Confessions", description: "Written or recorded admissions or accounts from the suspect.", type: "statement" },
        ];

        // Function to populate the evidence modal
        function populateEvidenceList() {
            evidenceListDiv.innerHTML = ''; // Clear existing list
            evidenceItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'evidence-item flex items-center p-2 rounded-md hover:bg-blue-100 cursor-pointer';
                div.innerHTML = `
                            <input type="checkbox" id="evidence-${item.name.replace(/\s/g, '-')}" value="${item.name}" class="form-checkbox h-5 w-5 text-blue-600 rounded-md">
                            <label for="evidence-${item.name.replace(/\s/g, '-')}" class="ml-2 text-gray-800 text-sm font-medium flex-grow">${item.name}</label>
                        `;
                div.setAttribute('data-description', item.description);
                div.setAttribute('data-type', item.type);
                if (item.linkProviders) {
                    div.setAttribute('data-link-providers', item.linkProviders.join(','));
                }

                // Add event listeners for hover to display description
                div.addEventListener('mouseenter', () => {
                    evidenceDescriptionDisplay.textContent = item.description;
                });
                div.addEventListener('mouseleave', () => {
                    evidenceDescriptionDisplay.textContent = 'Hover over an item for more details.';
                });

                // Add event listener for checkbox change
                const checkbox = div.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('change', (e) => {
                    const itemName = e.target.value;
                    const itemType = e.target.closest('.evidence-item').dataset.type;
                    const itemLinkProviders = e.target.closest('.evidence-item').dataset.linkProviders ? e.target.closest('.evidence-item').dataset.linkProviders.split(',') : [];

                    if (e.target.checked) {
                        selectedEvidenceDetails[itemName] = { type: itemType, links: [], text: '' };
                        if (itemType === 'statement') {
                            // Show the corresponding text area
                            switch (itemName) {
                                case 'Victim Statements': victimStatementsContainer.classList.remove('hidden'); break;
                                case 'Witness Statements': witnessStatementsContainer.classList.remove('hidden'); break;
                                case 'Suspect Statements/Confessions': suspectStatementsContainer.classList.remove('hidden'); break;
                            }
                        } else if (itemType === 'image' || itemType === 'video') {
                            // Open URL input modal
                            evidenceModal.classList.add('hidden'); // Hide evidence modal first
                            openUrlInputModal(itemName, itemLinkProviders);
                        }
                    } else {
                        delete selectedEvidenceDetails[itemName];
                        if (itemType === 'statement') {
                            // Hide the corresponding text area and clear its content
                            switch (itemName) {
                                case 'Victim Statements': victimStatementsContainer.classList.add('hidden'); victimStatementsTextarea.value = ''; break;
                                case 'Witness Statements': witnessStatementsContainer.classList.add('hidden'); witnessStatementsTextarea.value = ''; break;
                                case 'Suspect Statements/Confessions': suspectStatementsContainer.classList.add('hidden'); suspectStatementsTextarea.value = ''; break;
                            }
                        }
                    }
                    updateEvidenceCollectedInputSummary();
                });

                evidenceListDiv.appendChild(div);
            });
        }

        // Function to open the URL input modal
        function openUrlInputModal(itemName, providers) {
            urlModalTitle.textContent = `Add Links for ${itemName}`;
            allowedProvidersText.textContent = `Allowed providers: ${providers.map(p => p.replace('https://', '')).join(', ')}`;
            evidenceUrlInput.value = '';
            urlValidationError.classList.add('hidden');
            currentLinksDisplay.innerHTML = ''; // Clear previous links

            // Populate current links if any exist for this item
            if (selectedEvidenceDetails[itemName] && selectedEvidenceDetails[itemName].links) {
                selectedEvidenceDetails[itemName].links.forEach(link => {
                    const p = document.createElement('p');
                    p.textContent = link;
                    currentLinksDisplay.appendChild(p);
                });
            }

            urlInputModal.dataset.currentItem = itemName; // Store the current item being edited
            urlInputModal.dataset.allowedProviders = providers.join(','); // Store allowed providers
            urlInputModal.classList.remove('hidden');
        }

        // Function to validate URL
        function isValidUrl(url, allowedProviders) {
            try {
                const urlObj = new URL(url);
                const hostname = urlObj.hostname;
                return allowedProviders.some(provider => hostname.includes(provider));
            } catch (e) {
                return false;
            }
        }

        // Function to update the main evidence input field summary and its title attribute for hover
        function updateEvidenceCollectedInputSummary() {
            const summaryParts = [];
            const hoverTextParts = []; // To store text for the title attribute

            for (const itemName in selectedEvidenceDetails) {
                const item = selectedEvidenceDetails[itemName];
                if (item.type === 'statement') {
                    if (item.text.trim() !== '') {
                        summaryParts.push(`${itemName} (D)`); // (D) for details
                        hoverTextParts.push(`${itemName}: ${item.text.trim()}`);
                    } else {
                        summaryParts.push(itemName);
                        hoverTextParts.push(`${itemName}: No details provided.`);
                    }
                } else if (item.type === 'image' || item.type === 'video') {
                    if (item.links.length > 0) {
                        summaryParts.push(`${itemName} (L)`); // (L) for links
                        hoverTextParts.push(`${itemName}: ${item.links.join(', ')}`);
                    } else {
                        summaryParts.push(itemName);
                        hoverTextParts.push(`${itemName}: No links provided.`);
                    }
                } else {
                    summaryParts.push(itemName);
                    hoverTextParts.push(itemName); // Fallback for other types
                }
            }
            evidenceCollectedInput.value = summaryParts.join(', ');
            evidenceCollectedInput.title = hoverTextParts.join('\n'); // Set the title attribute for hover
        }


        // Function to show/hide fields based on report type
        function toggleReportFields() {
            const selectedReportType = reportTypeSelect.value;

            // Hide all report-specific field containers
            arrestReportFields.classList.add('hidden');
            trafficCitationFields.classList.add('hidden');
            useOfForceFields.classList.add('hidden');
            trespassNoticeFields.classList.add('hidden');
            businessIncidentFields.classList.add('hidden');
            incidentReportFields.classList.add('hidden'); // NEW Incident Report Fields

            // Hide all statement containers
            victimStatementsContainer.classList.add('hidden');
            witnessStatementsContainer.classList.add('hidden');
            suspectStatementsContainer.classList.add('hidden');

            // Show fields relevant to the selected report type
            switch (selectedReportType) {
                case 'Arrest Report':
                    arrestReportFields.classList.remove('hidden');
                    break;
                case 'Traffic Citation':
                    trafficCitationFields.classList.remove('hidden');
                    break;
                case 'Use of Force':
                    useOfForceFields.classList.remove('hidden');
                    break;
                case 'Trespass Notice':
                    trespassNoticeFields.classList.remove('hidden');
                    break;
                case 'Business Incident':
                    businessIncidentFields.classList.remove('hidden');
                    break;
                case 'Incident Report': // NEW Case
                    incidentReportFields.classList.remove('hidden');
                    break;
                default:
                    // No default action, all fields remain hidden
                    break;
            }

            // Re-evaluate visibility of statement text areas based on selectedEvidenceDetails
            for (const itemName in selectedEvidenceDetails) {
                const item = selectedEvidenceDetails[itemName];
                if (item.type === 'statement') {
                    switch (itemName) {
                        case 'Victim Statements': victimStatementsContainer.classList.remove('hidden'); break;
                        case 'Witness Statements': witnessStatementsContainer.classList.remove('hidden'); break;
                        case 'Suspect Statements/Confessions': suspectStatementsContainer.classList.remove('hidden'); break;
                    }
                }
            }
        }

        // Function to populate the officer list in the modal
        function populateOfficerList(officers, searchTerm = '') {
            officerListDiv.innerHTML = ''; // Clear existing list
            const filteredOfficers = officers.filter(officer =>
                officer.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                officer.badge.toLowerCase().includes(searchTerm.toLowerCase())
            );

            if (filteredOfficers.length === 0) {
                officerListDiv.innerHTML = '<p class="text-gray-500 text-center py-4">No officers found.</p>';
                return;
            }

            filteredOfficers.forEach(officer => {
                const div = document.createElement('div');
                div.className = 'officer-item p-2 rounded-md hover:bg-blue-100 cursor-pointer text-gray-800 text-sm font-medium';
                div.textContent = `${officer.name} (${officer.badge})`;
                div.dataset.name = officer.name;
                div.dataset.badge = officer.badge;

                div.addEventListener('click', () => {
                    officerInfoInput.value = `${officer.name} (${officer.badge})`;
                    officerSelectionModal.classList.add('hidden');
                });
                officerListDiv.appendChild(div);
            });
        }


        // Add event listener to report type dropdown to toggle fields
        reportTypeSelect.addEventListener('change', toggleReportFields);

        // Initialize fields visibility and populate evidence list on page load
        document.addEventListener('DOMContentLoaded', () => {
            toggleReportFields();
            populateEvidenceList();
            // Initial fetch of roster data is now triggered by clicking the officerInfoInput
        });

        // Event listeners for opening and closing the evidence modal
        evidenceCollectedInput.addEventListener('click', () => {
            evidenceModal.classList.remove('hidden');
            // Ensure checkboxes reflect current selectedEvidenceDetails when modal opens
            evidenceListDiv.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = !!selectedEvidenceDetails[checkbox.value];
            });
            evidenceDescriptionDisplay.textContent = 'Hover over an item for more details.'; // Reset description display
        });

        closeEvidenceModalBtn.addEventListener('click', () => {
            evidenceModal.classList.add('hidden');
        });

        // Close modal when clicking outside of it
        evidenceModal.addEventListener('click', (e) => {
            if (e.target === evidenceModal) {
                evidenceModal.classList.add('hidden');
            }
        });

        // URL Modal Logic
        addUrlBtn.addEventListener('click', () => {
            const url = evidenceUrlInput.value.trim();
            const currentItemName = urlInputModal.dataset.currentItem;
            const allowedProviders = urlInputModal.dataset.allowedProviders.split(',');

            urlValidationError.classList.add('hidden'); // Hide previous errors

            if (!url) {
                urlValidationError.textContent = 'URL cannot be empty.';
                urlValidationError.classList.remove('hidden');
                return;
            }

            if (!isValidUrl(url, allowedProviders)) {
                urlValidationError.textContent = `Invalid URL or not from allowed providers: ${allowedProviders.map(p => p.replace('https://', '')).join(', ')}.`;
                urlValidationError.classList.remove('hidden');
                return;
            }

            if (selectedEvidenceDetails[currentItemName]) {
                if (!selectedEvidenceDetails[currentItemName].links.includes(url)) {
                    selectedEvidenceDetails[currentItemName].links.push(url);
                    const p = document.createElement('p');
                    p.textContent = url;
                    currentLinksDisplay.appendChild(p);
                }
            }
            evidenceUrlInput.value = ''; // Clear input after adding
            updateEvidenceCollectedInputSummary(); // Update summary immediately after adding a link
        });

        closeUrlModalBtn.addEventListener('click', () => {
            urlInputModal.classList.add('hidden');
            evidenceModal.classList.remove('hidden'); // Bring back the evidence selection modal
            updateEvidenceCollectedInputSummary(); // Ensure summary is updated when done
        });

        urlInputModal.addEventListener('click', (e) => {
            if (e.target === urlInputModal) {
                urlInputModal.classList.add('hidden');
                evidenceModal.classList.remove('hidden'); // Bring back the evidence selection modal
                // This block handles the case where the user closes the URL modal by clicking outside
                // If no links were added for the current item, uncheck its checkbox and remove it from selectedEvidenceDetails
                const currentItemName = urlInputModal.dataset.currentItem;
                if (selectedEvidenceDetails[currentItemName] && selectedEvidenceDetails[currentItemName].links.length === 0) {
                    const checkbox = document.getElementById(`evidence-${currentItemName.replace(/\s/g, '-')}`);
                    if (checkbox) {
                        checkbox.checked = false;
                        delete selectedEvidenceDetails[currentItemName]; // Remove from details if no links
                    }
                }
                updateEvidenceCollectedInputSummary(); // Ensure summary is updated after any modal closure
            }
        });

        // Officer Selection Modal Logic
        officerInfoInput.addEventListener('click', async () => {
            officerSelectionModal.classList.remove('hidden');
            officerSearchInput.value = ''; // Clear search input
            officerListDiv.innerHTML = '<div class="loader mx-auto my-4"></div>'; // Show loader inside modal
            await fetchAndSetOfficerRosterData(); // Fetch and populate
        });

        officerSearchInput.addEventListener('input', (e) => {
            populateOfficerList(officerRosterData, e.target.value);
        });

        closeOfficerModalBtn.addEventListener('click', () => {
            officerSelectionModal.classList.add('hidden');
        });

        officerSelectionModal.addEventListener('click', (e) => {
            if (e.target === officerSelectionModal) {
                officerSelectionModal.classList.add('hidden');
            }
        });

        // Update selectedEvidenceDetails for statement text areas on input
        victimStatementsTextarea.addEventListener('input', (e) => {
            if (selectedEvidenceDetails['Victim Statements']) {
                selectedEvidenceDetails['Victim Statements'].text = e.target.value;
            }
            updateEvidenceCollectedInputSummary();
        });
        witnessStatementsTextarea.addEventListener('input', (e) => {
            if (selectedEvidenceDetails['Witness Statements']) {
                selectedEvidenceDetails['Witness Statements'].text = e.target.value;
            }
            updateEvidenceCollectedInputSummary();
        });
        suspectStatementsTextarea.addEventListener('input', (e) => {
            if (selectedEvidenceDetails['Suspect Statements/Confessions']) {
                selectedEvidenceDetails['Suspect Statements/Confessions'].text = e.target.value;
            }
            updateEvidenceCollectedInputSummary();
        });


        // IMPORTANT: Gemini API Key Configuration
        // If you are running this code on YOUR OWN WEB SERVER:
        // 1. Go to Google AI Studio (https://aistudio.google.com/app/apikey) or Google Cloud.
        // 2. Generate a new API key.
        // 3. Replace the empty string below with your ACTUAL, VALID API key.
        //    Example: const apiKey = "YOUR_ACTUAL_GEMINI_API_KEY_HERE";
        // If you are running this within the Google Canvas environment, leave this as "".
        const apiKey = "AIzaSyCsWMWfmCfR59mcAy4as7XR95YY__7hayc";

        // Add event listener to the "Generate Report" button
        generateReportBtn.addEventListener('click', async () => {
            const selectedReportType = reportTypeSelect.value;
            const department = departmentSelect.value;
            const officerInfo = officerInfoInput.value.trim(); // Common officer info
            const now = new Date();
            const localDate = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            const localTime = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

            generatedReportTextarea.value = '';
            copyReportBtn.classList.add('hidden');
            downloadReportBtn.classList.add('hidden'); // Hide download button on new generation
            viewReportBtn.classList.add('hidden'); // Hide view button on new generation
            loadingIndicator.classList.remove('hidden');

            let prompt = '';
            let reportNarrative = ''; // Common variable for narrative across reports
            let requiredFieldsFilled = true; // Flag for validation

            // Prepare evidence string for prompt
            let evidenceForPrompt = '';
            const evidenceParts = [];
            for (const itemName in selectedEvidenceDetails) {
                const item = selectedEvidenceDetails[itemName];
                if (item.type === 'statement') {
                    if (item.text.trim() !== '') {
                        evidenceParts.push(`${itemName}: ${item.text.trim()}`);
                    } else {
                        evidenceParts.push(`${itemName}: No details provided.`);
                    }
                } else if (item.type === 'image' || item.type === 'video') {
                    if (item.links.length > 0) {
                        evidenceParts.push(`${itemName}: ${item.links.join(', ')}`);
                    } else {
                        evidenceParts.push(`${itemName}: No links provided.`);
                    }
                } else {
                    evidenceParts.push(itemName);
                }
            }
            evidenceForPrompt = evidenceParts.length > 0 ? evidenceParts.join('\n') : 'None';


            // Determine which API key to use
            const finalApiKey = typeof __api_key__ !== 'undefined' ? __api_key__ : apiKey;

            if (!finalApiKey || finalApiKey === "YOUR_ACTUAL_GEMINI_API_KEY_HERE") {
                generatedReportTextarea.value = 'Error: Gemini API Key is not configured. Please ensure your API key is correctly set in the JavaScript code. If running on your own server, replace the empty string for `apiKey` with your actual key.';
                console.error('API Key not configured. Please set your actual Gemini API key if running on your own server.');
                loadingIndicator.classList.add('hidden');
                return;
            }

            // Construct prompt based on report type
            switch (selectedReportType) {
                case 'Arrest Report':
                    reportNarrative = arrestNarrativeTextarea.value.trim();
                    const suspectName = suspectNameInput.value.trim();
                    const charges = chargesInput.value.trim();
                    const mirandized = mirandizedSelect.value;
                    const gsrTest = gsrTestSelect.value;
                    const legalRepresentation = legalRepresentationInput.value.trim();
                    const levelOfForce = levelOfForceSelect.value;
                    const medicalTreatment = medicalTreatmentSelect.value;
                    const pleaType = pleaTypeSelect.value;

                    if (!officerInfo || !suspectName || !charges || !reportNarrative || mirandized === "" || gsrTest === "" || medicalTreatment === "" || pleaType === "" || levelOfForce === "") {
                        requiredFieldsFilled = false;
                    }

                    if (requiredFieldsFilled) {
                        prompt = `${localDate}, ${localTime} ${timeZone}

Officer: ${officerInfo} ${department}
City/State: Los Santos, San Andreas (SA)

Generate a detailed, professional, and concise police report. The report must strictly adhere to the information provided in the "Officer Narrative" and other text fields. Do not include any information that is not directly deducible from the provided inputs. The output must strictly follow the format provided below, with no additional text, introductory phrases, or markdown formatting (like bold, italics, headers, or bullet points). Ensure all fields are populated appropriately based on the input. If a field is not directly deducible from the input, provide a reasonable placeholder or "N/A". The report should be written as if you were the officer writing it. Make sure to include the officers name, rank if included and badge number. Also, explicitly mention the suspect's name in the debrief.

Suspect Name: ${suspectName}
Charges: ${charges}
Officer Narrative: ${reportNarrative}
Mirandized: ${mirandized}
GSR Test: ${gsrTest}
Name of Legal Representation: ${legalRepresentation || 'N/A'}
Level of Force: ${levelOfForce}
Medical Treatment: ${medicalTreatment}
Plea Type: ${pleaType}
Evidence Collected:
${evidenceForPrompt}

---
Strict Output Format:
Debrief: [Detailed summary of the incident based on the narrative and provided information, explicitly mentioning the suspect's name: ${suspectName}. Focus on the factual account of events, what happened, and actions taken by law enforcement.]

Justification of Charges:
${charges.split(',').map(charge => `(${charge.trim()}): [Reason for this specific charge based on the narrative and incident details]`).join('\n')}

Postal/Location: [Location of the incident, if mentioned in narrative, otherwise provide a general placeholder like "Los Santos, SA"]

Evidence Collected:
${evidenceForPrompt}

Level of Force: ${levelOfForce}
Medical Treatment (Y | N): ${medicalTreatment}
GSR Test (positive | negative): ${gsrTest}
Legal Representation: ${legalRepresentation || 'N/A'}
Mirandized (Y | N): ${mirandized}
Plea (guilty | not guilty | no contest): ${pleaType}
`;
                    }
                    break;

                case 'Traffic Citation':
                    reportNarrative = citationNarrativeTextarea.value.trim();
                    const driverName = driverNameInput.value.trim();
                    const driverLicense = driverLicenseInput.value.trim();
                    const vehicleMakeModel = vehicleMakeModelInput.value.trim();
                    const vehiclePlate = vehiclePlateInput.value.trim();
                    const violation = violationInput.value.trim();
                    const citationLocation = citationLocationInput.value.trim();

                    if (!officerInfo || !driverName || !driverLicense || !vehicleMakeModel || !vehiclePlate || !violation || !citationLocation || !reportNarrative) {
                        requiredFieldsFilled = false;
                    }

                    if (requiredFieldsFilled) {
                        prompt = `${localDate}, ${localTime} ${timeZone}

Officer: ${officerInfo} ${department}
City/State: Los Santos, San Andreas (SA)

Generate a detailed, professional, and concise Traffic Citation report. The report must strictly adhere to the information provided in the "Officer Narrative" and other text fields. Do not include any information that is not directly deducible from the provided inputs. The output must strictly follow the format provided below, with no additional text, introductory phrases, or markdown formatting (like bold, italics, headers, or bullet points). Ensure all fields are populated appropriately based on the input. If a field is not directly deducible from the input, provide a reasonable placeholder or "N/A". The report should be written as if you were the officer writing it. Make sure to include the officer's name, rank if included, and badge number.

Driver's Full Name: ${driverName}
Driver's License: ${driverLicense}
Vehicle Make/Model: ${vehicleMakeModel}
Vehicle Plate Number: ${vehiclePlate}
Violation: ${violation}
Location of Violation: ${citationLocation}
Officer Narrative: ${reportNarrative}
Evidence Collected:
${evidenceForPrompt}

---
Strict Output Format:
TRAFFIC CITATION REPORT

Issuing Officer: ${officerInfo}
Department: ${department}
Date/Time of Issuance: ${localDate}, ${localTime} ${timeZone}
Location of Violation: ${citationLocation}

Driver Information:
Name: ${driverName}
License: ${driverLicense}

Vehicle Information:
Make/Model: ${vehicleMakeModel}
License Plate: ${vehiclePlate}

Violation Details:
Offense: ${violation}
Narrative: [Detailed description of the traffic stop and violation, based on the officer narrative.]

Evidence Collected:
${evidenceForPrompt}
Action Taken: Citation Issued.
`;
                    }
                    break;

                case 'Use of Force':
                    reportNarrative = uofNarrativeTextarea.value.trim();
                    const subjectName = subjectNameInput.value.trim();
                    const uofLevelOfForce = uofLevelOfForceSelect.value;
                    const uofReason = uofReasonTextarea.value.trim();
                    const uofInjuries = uofInjuriesTextarea.value.trim();
                    const uofMedicalTreatment = uofMedicalTreatmentSelect.value;

                    if (!officerInfo || !subjectName || uofLevelOfForce === "" || !uofReason || !reportNarrative || uofMedicalTreatment === "") {
                        requiredFieldsFilled = false;
                    }

                    if (requiredFieldsFilled) {
                        prompt = `${localDate}, ${localTime} ${timeZone}

Officer: ${officerInfo} ${department}
City/State: Los Santos, San Andreas (SA)

Generate a detailed, professional, and concise Use of Force report. The report must strictly adhere to the information provided in the "Officer Narrative" and other text fields. Do not include any information that is not directly deducible from the provided inputs. The output must strictly follow the format provided below, with no additional text, introductory phrases, or markdown formatting (like bold, italics, headers, or bullet points). Ensure all fields are populated appropriately based on the input. If a field is not directly deducible from the input, provide a reasonable placeholder or "N/A". The report should be written as if you were the officer writing it. Make sure to include the officer's name, rank if included, and badge number. Also, explicitly mention the subject's name in the narrative.

Subject's Full Name: ${subjectName}
Level of Force Used: ${uofLevelOfForce}
Reason for Use of Force: ${uofReason}
Injuries Sustained (Officer/Subject): ${uofInjuries || 'None'}
Medical Treatment Provided/Requested: ${uofMedicalTreatment}
Officer Narrative: ${reportNarrative}
Evidence Collected:
${evidenceForPrompt}

---
Strict Output Format:
USE OF FORCE REPORT

Reporting Officer: ${officerInfo}
Department: ${department}
Date/Time of Incident: ${localDate}, ${localTime} ${timeZone}
Location of Incident: [Location of incident, if mentioned in narrative, otherwise provide a general placeholder like "Los Santos, SA"]

Subject Information:
Name: ${subjectName}

Incident Details:
Level of Force Used: ${uofLevelOfForce}
Reason for Use of Force: ${uofReason}
Narrative: [Detailed account of the incident leading to and including the use of force, explicitly mentioning the subject's name: ${subjectName}, based on the officer narrative.]

Injuries:
Officer Injuries: [Description of officer injuries, if any, based on input]
Subject Injuries: [Description of subject injuries, if any, based on input]
Medical Treatment Provided/Requested: ${uofMedicalTreatment}
Evidence Collected:
${evidenceForPrompt}
`;
                    }
                    break;

                case 'Trespass Notice':
                    reportNarrative = trespassNarrativeTextarea.value.trim();
                    const trespasserName = trespasserNameInput.value.trim();
                    const trespassLocation = trespassLocationInput.value.trim();
                    const propertyOwner = propertyOwnerInput.value.trim();
                    const trespassReason = trespassReasonTextarea.value.trim();
                    const trespassDuration = trespassDurationInput.value.trim();

                    if (!officerInfo || !trespasserName || !trespassLocation || !propertyOwner || !trespassReason || !trespassDuration || !reportNarrative) {
                        requiredFieldsFilled = false;
                    }

                    if (requiredFieldsFilled) {
                        prompt = `${localDate}, ${localTime} ${timeZone}

Officer: ${officerInfo} ${department}
City/State: Los Santos, San Andreas (SA)

Generate a detailed, professional, and concise Trespass Notice report. The report must strictly adhere to the information provided in the "Officer Narrative" and other text fields. Do not include any information that is not directly deducible from the provided inputs. The output must strictly follow the format provided below, with no additional text, introductory phrases, or markdown formatting (like bold, italics, headers, or bullet points). Ensure all fields are populated appropriately based on the input. If a field is not directly deducible from the input, provide a reasonable placeholder or "N/A". The report should be written as if you were the officer writing it. Make sure to include the officer's name, rank if included, and badge number. Also, explicitly mention the trespasser's name in the narrative.

Trespasser's Full Name: ${trespasserName}
Property Address: ${trespassLocation}
Property Owner/Manager Name: ${propertyOwner}
Reason for Trespass Notice: ${trespassReason}
Duration of Ban: ${trespassDuration}
Officer Narrative: ${reportNarrative}
Evidence Collected:
${evidenceForPrompt}

---
Strict Output Format:
TRESPASS NOTICE REPORT

Issuing Officer: ${officerInfo}
Department: ${department}
Date/Time of Issuance: ${localDate}, ${localTime} ${timeZone}

Trespasser Information:
Name: ${trespasserName}

Property Information:
Address: ${trespassLocation}
Owner/Manager: ${propertyOwner}

Notice Details:
Reason for Notice: ${trespassReason}
Duration of Ban: ${trespassDuration}
Narrative: [Detailed description of the incident leading to the trespass notice, explicitly mentioning the trespasser's name: ${trespasserName}, based on the officer narrative.]

Evidence Collected:
${evidenceForPrompt}
Warning: Failure to comply with this notice may result in arrest and prosecution.
`;
                    }
                    break;

                case 'Business Incident':
                    reportNarrative = bizNarrativeTextarea.value.trim();
                    const businessName = businessNameInput.value.trim();
                    const businessAddress = businessAddressInput.value.trim();
                    const incidentType = incidentTypeInput.value.trim();
                    const involvedParties = involvedPartiesTextarea.value.trim();
                    const damagesTheft = damagesTheftTextarea.value.trim();

                    if (!officerInfo || !businessName || !businessAddress || !incidentType || !involvedParties || !reportNarrative) {
                        requiredFieldsFilled = false;
                    }

                    if (requiredFieldsFilled) {
                        prompt = `${localDate}, ${localTime} ${timeZone}

Officer: ${officerInfo} ${department}
City/State: Los Santos, San Andreas (SA)

Generate a detailed, professional, and concise Business Incident report. The report must strictly adhere to the information provided in the "Officer Narrative" and other text fields. Do not include any information that is not directly deducible from the provided inputs. The output must strictly follow the format provided below, with no additional text, introductory phrases, or markdown formatting (like bold, italics, headers, or bullet points). Ensure all fields are populated appropriately based on the input. If a field is not directly deducible from the input, provide a reasonable placeholder or "N/A". The report should be written as if you were the officer writing it. Make sure to include the officer's name, rank if included, and badge number. Also, explicitly mention the involved parties in the narrative.

Business Name: ${businessName}
Business Address: ${businessAddress}
Type of Incident: ${incidentType}
Involved Parties (Names/Roles): ${involvedParties}
Damages/Theft Description: ${damagesTheft || 'None'}
Officer Narrative: ${reportNarrative}
Evidence Collected:
${evidenceForPrompt}

---
Strict Output Format:
BUSINESS INCIDENT REPORT

Reporting Officer: ${officerInfo}
Department: ${department}
Date/Time of Incident: ${localDate}, ${localTime} ${timeZone}

Business Information:
Name: ${businessName}
Address: ${businessAddress}

Incident Details:
Type of Incident: ${incidentType}
Involved Parties: ${involvedParties}
Damages/Theft: ${damagesTheft || 'None'}
Narrative: [Detailed account of the business incident, explicitly mentioning the involved parties: ${involvedParties}, based on the officer narrative.]

Evidence Collected:
${evidenceForPrompt}
Action Taken: [Describe actions taken by law enforcement, e.g., Report filed, Investigation initiated, Parties warned/advised.]
`;
                    }
                    break;

                case 'Incident Report': // NEW Incident Report Case
                    const incidentLocation = incidentLocationInput.value.trim();
                    const incidentDate = incidentDateInput.value.trim();
                    const incidentTime = incidentTimeInput.value.trim();
                    const primaryIncidentType = primaryIncidentTypeInput.value.trim();
                    const affectedParties = affectedPartiesTextarea.value.trim();
                    const incidentDescription = incidentDescriptionTextarea.value.trim();
                    const actionsTaken = actionsTakenTextarea.value.trim();

                    if (!officerInfo || !incidentLocation || !incidentDate || !incidentTime || !primaryIncidentType || !affectedParties || !incidentDescription || !actionsTaken) {
                        requiredFieldsFilled = false;
                    }

                    if (requiredFieldsFilled) {
                        prompt = `${localDate}, ${localTime} ${timeZone}

Officer: ${officerInfo} ${department}
City/State: Los Santos, San Andreas (SA)

Generate a detailed, professional, and concise Incident Report. The report must strictly adhere to the information provided in the "Incident Description" and other text fields. Do not include any information that is not directly deducible from the provided inputs. The output must strictly follow the format provided below, with no additional text, introductory phrases, or markdown formatting (like bold, italics, headers, or bullet points). Ensure all fields are populated appropriately based on the input. If a field is not directly deducible from the input, provide a reasonable placeholder or "N/A". The report should be written as if you were the officer writing it. Make sure to include the officer's name, rank if included, and badge number. Also, explicitly mention the affected parties in the narrative.

Location of Incident: ${incidentLocation}
Date of Incident: ${incidentDate}
Time of Incident: ${incidentTime}
Primary Incident Type: ${primaryIncidentType}
Affected Parties (Names/Roles): ${affectedParties}
Incident Description: ${incidentDescription}
Actions Taken by Officer: ${actionsTaken}
Evidence Collected:
${evidenceForPrompt}

---
Strict Output Format:
INCIDENT REPORT

Reporting Officer: ${officerInfo}
Department: ${department}
Date of Report: ${localDate}
Time of Report: ${localTime} ${timeZone}

Incident Details:
Location: ${incidentLocation}
Date: ${incidentDate}
Time: ${incidentTime}
Primary Type: ${primaryIncidentType}

Involved Parties:
${affectedParties}

Incident Narrative: [Detailed description of the incident, explicitly mentioning the affected parties: ${affectedParties}, based on the incident description provided.]

Actions Taken: [Detailed description of actions taken by the officer, based on the actions taken provided.]

Evidence Collected:
${evidenceForPrompt}
Status: Report Filed.
`;
                    }
                    break;

                default:
                    generatedReportTextarea.value = 'Invalid report type selected.';
                    loadingIndicator.classList.add('hidden');
                    return;
            }

            if (!requiredFieldsFilled) {
                generatedReportTextarea.value = 'Please fill in all required fields for the selected report type to generate the report.';
                loadingIndicator.classList.add('hidden');
                // Ensure download button is hidden if required fields are not filled
                downloadReportBtn.classList.add('hidden');
                viewReportBtn.classList.add('hidden'); // Hide view button if fields are not filled
                return;
            }

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${finalApiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    generatedReportTextarea.value = `Error: API call failed with status ${response.status}. Details: ${errorBody}`;
                    console.error('API Error Response:', response.status, errorBody);
                    loadingIndicator.classList.add('hidden');
                    downloadReportBtn.classList.add('hidden'); // Hide download button on API error
                    viewReportBtn.classList.add('hidden'); // Hide view button on API error
                    return;
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    let generatedText = result.candidates[0].content.parts[0].text;
                    generatedText = generatedText.replace(/[<>]/g, '').trim();
                    generatedReportTextarea.value = generatedText;
                    copyReportBtn.classList.remove('hidden');
                    downloadReportBtn.classList.remove('hidden'); // Show download button after successful generation
                    viewReportBtn.classList.remove('hidden'); // Show view button after successful generation
                } else {
                    generatedReportTextarea.value = 'Failed to generate report. Gemini API returned an unexpected structure or no content.';
                    console.error('Gemini API returned an unexpected structure or no content:', result);
                    copyReportBtn.classList.add('hidden');
                    downloadReportBtn.classList.add('hidden');
                    viewReportBtn.classList.add('hidden');
                }
            } catch (error) {
                generatedReportTextarea.value = `An error occurred: ${error.message}. Please check your network connection and try again.`;
                console.error('Error during API call or processing:', error);
                copyReportBtn.classList.add('hidden');
                downloadReportBtn.classList.add('hidden');
                viewReportBtn.classList.add('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        });

        // Add event listener for the new Copy Report button
        copyReportBtn.addEventListener('click', () => {
            let textToCopy = generatedReportTextarea.value.trim().replace(/[<>]/g, '');

            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            tempTextArea.style.position = 'absolute';
            tempTextArea.style.left = '-9999px';
            document.body.appendChild(tempTextArea);

            tempTextArea.select();
            document.execCommand('copy');

            const originalText = copyReportBtn.textContent;
            copyReportBtn.textContent = 'Copied!';
            setTimeout(() => {
                copyReportBtn.textContent = originalText;
            }, 1500);
        });

        // Function to generate PDF content (reused for both download and view)
        const generatePdfContent = async () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const department = departmentSelect.value;
            const officerInfo = officerInfoInput.value.trim();
            const generatedReportText = generatedReportTextarea.value.trim();
            const now = new Date();
            const reportDate = now.toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' });
            const currentYear = now.getFullYear();
            const currentMonth = now.toLocaleString('en-US', { month: 'long' });
            const currentDay = now.getDate();
            const selectedReportType = reportTypeSelect.value; // Get the selected report type

            // Function to load image as base64
            const getImageBase64 = (url) => {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = 'Anonymous'; // Required for CORS if image is from another domain
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        resolve(canvas.toDataURL('image/png')); // Convert to PNG for transparency
                    };
                    img.onerror = (error) => reject(error);
                    img.src = url;
                });
            };

            let lspdLogoBase64 = '';
            try {
                // Use the onerror fallback URL for LSPD.png if the direct path fails
                const imgElement = document.querySelector('img[alt="LSPD Logo"]');
                const logoUrl = imgElement.src || 'https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png';
                lspdLogoBase64 = await getImageBase64(logoUrl);
            } catch (error) {
                console.error('Error loading LSPD logo for PDF:', error);
                // Optionally, you can add a placeholder text or simply skip the image if it fails to load
            }


            // Set font and size for the main title
            doc.setFontSize(16);
            // Modified to include the report type
            doc.text(`${department} ${selectedReportType}`, 20, 20);

            // Add LSPD logo if available
            if (lspdLogoBase64) {
                doc.addImage(lspdLogoBase64, 'PNG', 170, 10, 25, 25); // Adjust position and size as needed
            }

            // Case Number and Date
            doc.setFontSize(10);
            doc.text(`Case Number: ${Math.floor(Math.random() * 1000000)}`, 20, 40); // Placeholder case number
            doc.text(`Date: ${reportDate}`, 150, 40);

            // Add a line separator
            doc.line(20, 45, 190, 45); // x1, y1, x2, y2

            // Report Body (Generated Report Text)
            doc.setFontSize(10);
            const splitText = doc.splitTextToSize(generatedReportText, 170); // Max width 170mm
            let currentY = 55; // Starting Y position for the report text
            doc.text(splitText, 20, currentY);

            // Get the current Y position after adding the report text
            // Calculate finalY based on the last line of text added
            let finalY = currentY + (splitText.length * doc.internal.getLineHeight());

            // Add a line separator before footer
            doc.line(20, finalY + 10, 190, finalY + 10);

            // Footer information
            finalY += 20;
            doc.text(`Reporting Officer: ${officerInfo}`, 20, finalY);
            finalY += 7;
            doc.text(`Date: ${currentMonth} ${currentDay}, ${currentYear}`, 20, finalY);
            finalY += 7;
            doc.text(`Sworn to and subscribed before me this ________ day of __________, ${currentYear}.`, 20, finalY);
            finalY += 7;
            doc.text(`Notary/Law Enforcement Officer: _____________________________________`, 20, finalY);
            finalY += 7;
            doc.text(`Supervisor Approval: _____________________________________`, 20, finalY);

            return doc; // Return the jsPDF document object
        };

        // Event listener for the Download Report button
        downloadReportBtn.addEventListener('click', async () => {
            const doc = await generatePdfContent();
            const department = departmentSelect.value;
            const selectedReportType = reportTypeSelect.value;
            const now = new Date();
            const reportDate = now.toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' });
            doc.save(`${department.replace(/\s/g, '_')}_${selectedReportType.replace(/\s/g, '_')}_Report_${reportDate}.pdf`);
        });

        // NEW: Event listener for the View Report button
        viewReportBtn.addEventListener('click', async () => {
            const doc = await generatePdfContent();
            const pdfBlob = doc.output('blob');
            const pdfUrl = URL.createObjectURL(pdfBlob);
            window.open(pdfUrl, '_blank');
        });
    </script>
</body>
</html>
