<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Police Department - Charge Calculator</title>
    <!-- Favicon added here -->
    <link rel="icon" href="LSPD.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: #555;
            }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            width: 450px;
            text-align: center;
            position: relative;
        }

        .modal-close-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
        }

            .modal-close-btn:hover {
                color: #333;
            }

        /* Loading indicator styles */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Specific styles for the charge selection modal */
        #chargeSelectionModal .modal-content {
            width: 700px; /* Wider for charge selection */
            max-width: 95%;
            display: flex;
            flex-direction: column;
            max-height: 90vh; /* Limit height for scrollable content */
        }

        #chargeSearchInput {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 0.375rem;
            width: 100%;
        }

        #available-charges-container {
            flex-grow: 1;
            overflow-y: auto; /* Make this section scrollable */
            padding: 1rem 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            margin-bottom: 1rem;
        }

        .charge-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease-in-out;
            border-radius: 0.375rem;
            margin-bottom: 0.25rem;
        }

            .charge-item:hover {
                background-color: #e0f2fe; /* Light blue on hover */
            }

            .charge-item.selected {
                background-color: #dbeafe; /* Lighter blue for selected */
                border-color: #93c5fd; /* Blue border for selected */
                font-weight: 500;
            }

            .charge-item:last-child {
                border-bottom: none;
            }

        #modal-selected-charges {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }

        .modal-selected-charge-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed #e0e0e0;
        }

            .modal-selected-charge-item:last-child {
                border-bottom: none;
            }

            .modal-selected-charge-item input[type="number"] {
                width: 60px;
                padding: 0.25rem;
                border: 1px solid #ccc;
                border-radius: 0.25rem;
                text-align: center;
                margin-left: 0.5rem;
            }

        /* Light Mode */
        body.light-mode {
            background-color: #f8f8f8;
            color: #333;
        }

            body.light-mode .bg-blue-900 {
                background-color: #1e3a8a; /* Darker blue for header */
            }

            body.light-mode .text-white {
                color: #ffffff;
            }

            body.light-mode .bg-gradient-to-r {
                background-image: linear-gradient(to right, #1e3a8a, #102a43); /* Darker blue gradient */
            }

            body.light-mode .bg-blue-50 {
                background-color: #e0f2fe; /* Light blue */
            }

            body.light-mode .bg-gray-100 {
                background-color: #f3f4f6;
            }

            body.light-mode .bg-white {
                background-color: #ffffff;
            }

            body.light-mode .text-blue-700 {
                color: #1d4ed8;
            }

            body.light-mode .text-blue-800 {
                color: #1e40af;
            }

            body.light-mode .text-gray-800 {
                color: #1f2937;
            }

            body.light-mode .text-gray-600 {
                color: #4b5563;
            }

            body.light-mode .text-gray-700 {
                color: #374151;
            }

            body.light-mode .text-blue-500 {
                color: #3b82f6;
            }

            body.light-mode .bg-gray-800 {
                background-color: #1f2937;
            }

            body.light-mode .text-blue-300 {
                color: #93c5fd;
            }

            body.light-mode .text-gray-400 {
                color: #9ca3af;
            }

            body.light-mode .text-gray-500 {
                color: #6b7280;
            }


        /* Dark Mode */
        body.dark-mode {
            background-color: #1a202c; /* bg-gray-900 */
            color: #e2e8f0; /* Default text color for dark mode body */
        }

            body.dark-mode .bg-blue-900 {
                background-color: #2d3748; /* Darker header */
            }

            body.dark-mode .text-white {
                color: #e2e8f0;
            }

            body.dark-mode .bg-gradient-to-r {
                background-image: linear-gradient(to right, #2d3748, #1a202c);
            }

            body.dark-mode .bg-blue-50 {
                background-color: #2f3e58; /* Darker light blue for card backgrounds */
            }

            body.dark-mode .bg-gray-100 {
                background-color: #2d3748;
            }

            body.dark-mode .bg-white {
                background-color: #2d3748;
            }

            body.dark-mode .text-blue-700 {
                color: #90cdf4;
            }

            body.dark-mode .text-blue-800 {
                color: #a7d9ff;
            }

            /* Ensure main content text colors are readable in dark mode */
            body.dark-mode main h2,
            body.dark-mode main p {
                color: #e2e8f0; /* General text color for main content */
            }

            /* Override for specific elements that use Tailwind's text-gray-X00 classes */
            body.dark-mode .text-gray-800 {
                color: #e2e8f0;
            }

            body.dark-mode .text-gray-600 {
                color: #a0aec0;
            }

            body.dark-mode .text-gray-700 {
                color: #cbd5e0;
            }

            body.dark-mode .text-blue-500 {
                color: #63b3ed;
            }

            body.dark-mode .bg-gray-800 {
                background-color: #1a202c;
            }

            body.dark-mode .text-blue-300 {
                color: #90cdf4;
            }

            body.dark-mode .text-gray-400 {
                color: #a0aec0;
            }

            body.dark-mode .text-gray-500 {
                color: #cbd5e0;
            }

            body.dark-mode .shadow-lg,
            body.dark-mode .shadow-xl,
            body.dark-mode .shadow-inner {
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2);
            }

            body.dark-mode .modal-content {
                background-color: #2d3748;
            }

            body.dark-mode .modal-overlay {
                background-color: rgba(0, 0, 0, 0.8);
            }

            body.dark-mode .border {
                border-color: #4a5568;
            }

            /* Officer card specific text colors for dark mode */
            body.dark-mode .officer-card .text-blue-800 { /* Name */
                color: #90cdf4; /* A light blue for names in dark mode */
            }

            body.dark-mode .officer-card .text-gray-700 { /* Rank, etc. */
                color: #cbd5e0; /* Lighter gray for details */
            }

            body.dark-mode .officer-card .text-gray-500 { /* Hire Date, etc. */
                color: #a0aec0; /* Even lighter gray for less prominent text */
            }

            body.dark-mode .officer-card {
                background-color: #2d3748; /* Darker background for cards */
            }

                body.dark-mode .officer-card.border-yellow-500 {
                    border-color: #fbd38d; /* Lighter yellow border for highlight */
                    box-shadow: 0 0 0 4px #f6e05e; /* Lighter yellow ring */
                }

            /* Officer summary section text and background */
            body.dark-mode #officer-summary p {
                color: #e2e8f0; /* Ensure summary text is light */
            }

            body.dark-mode #officer-summary .text-blue-800 {
                color: #90cdf4; /* Keep blue-800 for titles */
            }

            body.dark-mode #officer-summary .text-blue-900 {
                color: #a7d9ff; /* Keep blue-900 for numbers */
            }

            body.dark-mode #officer-summary > div {
                background-color: #2d3748; /* Darker background for summary boxes */
            }

            /* Adjust modal text colors for dark mode */
            body.dark-mode #settingsModal .radio-option label,
            body.dark-mode #dataViewerModal .modal-content h3,
            body.dark-mode #confirmDeleteModal .modal-content h3,
            body.dark-mode #confirmDeleteModal .modal-content p {
                color: #e2e8f0; /* Ensure modal text is light */
            }

            body.dark-mode .data-viewer-item .title {
                color: #90cdf4; /* Make data viewer titles a distinct light blue */
            }

            body.dark-mode .data-viewer-item .description {
                color: #cbd5e0; /* Make data viewer descriptions a lighter gray */
            }

        /* Settings icon styles */
        #settingsIcon {
            width: 28px; /* Slightly larger icon */
            height: 28px;
            cursor: pointer;
            margin-left: 1.5rem; /* Space from navigation links */
            transition: transform 0.2s ease-in-out;
            filter: brightness(0) invert(1); /* Makes the icon white */
        }

            #settingsIcon:hover {
                transform: rotate(15deg);
            }

        body.dark-mode #settingsIcon {
            filter: none; /* Keep original color or adjust if necessary for dark mode */
        }

        /* Settings modal specific styles */
        #settingsModal .modal-content {
            width: 350px; /* Adjust width for settings modal */
        }

        #settingsModal .radio-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

            #settingsModal .radio-option input[type="radio"] {
                margin-right: 0.5rem;
            }

            #settingsModal .radio-option label {
                font-size: 1rem;
                color: #333;
            }

        body.dark-mode #settingsModal .radio-option label {
            color: #e2e8f0;
        }

        #settingsModal button {
            margin-top: 1rem;
            width: 100%;
        }

        /* Data Viewer Modal Styles */
        #dataViewerModal .modal-content {
            width: 600px;
            max-width: 95%;
        }

        #dataViewerContent {
            background-color: #f4f4f4;
            border-radius: 0.5rem;
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }

        body.dark-mode #dataViewerContent {
            background-color: #1f2937;
            border-color: #4a5568;
            color: #e2e8f0;
        }

        /* Styles for data viewer items, similar to updates */
        .data-viewer-item {
            background-color: #ffffff;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 0.75rem;
        }

        body.dark-mode .data-viewer-item {
            background-color: #2d3748;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .data-viewer-item p {
            margin: 0;
            line-height: 1.5;
        }

        .data-viewer-item .title {
            font-weight: 600; /* font-semibold */
            color: #1f2937; /* text-gray-800 */
        }

        body.dark-mode .data-viewer-item .title {
            color: #e2e8f0;
        }

        .data-viewer-item .description {
            font-size: 0.875rem; /* text-sm */
            color: #4b5563; /* text-gray-600 */
        }

        body.dark-mode .data-viewer-item .description {
            color: #a0aec0;
        }

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw; /* Use viewport width */
            height: 100vh; /* Use viewport height */
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* Very high z-index */
        }

        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-2xl */
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            width: 500px; /* Adjusted width for better readability */
        }

        /* Footer Separation for Dark Mode */
        body.dark-mode footer {
            border-top: 3px solid #4a5568; /* A subtle, distinct border for separation */
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.3); /* Add a shadow for more depth */
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header Section -->
    <header class="bg-blue-900 text-white shadow-lg py-4 px-6 md:px-12 flex items-center justify-between sticky top-0 z-50 rounded-b-lg relative">
        <div class="flex items-center">
            <!-- UPD Logo -->
            <img src="LSPD.png" alt="UPD Logo" class="mr-4 w-16 h-16 object-contain" onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/Tony-Dunkle/Nightlife-lspd/740c11da2aa53715804bfc13b8e3cc3762a3274d/LSPD.png';">
            <!-- Responsive font size: text-2xl for small screens, text-3xl for medium screens and up -->
            <h1 class="text-2xl md:text-3xl font-bold">Unified Police Department</h1>
        </div>

        <!-- Hamburger Menu Button for Mobile -->
        <button id="hamburgerBtn" class="hamburger-menu text-white focus:outline-none md:hidden">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-4 6h4"></path>
            </svg>
        </button>

        <!-- Navigation Menu -->
        <!-- Added md:flex-grow to nav to allow it to take available space -->
        <nav class="nav-links md:flex md:flex-grow md:justify-end">
            <!-- Changed md:space-x-8 to md:space-x-4 and added md:flex-wrap for stacking -->
            <ul class="flex flex-col md:flex-row md:flex-wrap md:justify-end space-y-2 md:space-y-0 md:space-x-4 text-sm font-medium">
                <li><a href="index.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Dashboard</a></li>
                <li><a href="SOP.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">SOPs</a></li>
                <li><a href="training.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Training</a></li>
                <li><a href="forms.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Forms</a></li>
                <li><a href="roster.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Roster</a></li>
                <li><a href="hr.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">HR Info</a></li>
                <li><a href="report.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Report Generator</a></li>
                <li><a href="charges.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700 current-page">Charge Calculator</a></li>
                <li><a href="info.html" class="nav-item-link text-blue-200 hover:text-white transition duration-300 ease-in-out py-1 px-2 rounded-md hover:bg-blue-700">Common Information</a></li>
            </ul>
        </nav>
        <!-- Settings Icon (Removed as it's not present in this HTML file) -->
        <!-- <img src="settings.png" alt="Settings" id="settingsIcon" class="ml-4 cursor-pointer"> -->
    </header>

    <!-- Main Content Section - Charge Calculator -->
    <main class="container mx-auto px-4 md:px-8 py-12 flex-grow">
        <section class="bg-white p-6 md:p-8 rounded-lg shadow-xl mb-12">
            <h2 class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-6 text-center border-b-4 border-blue-500 pb-3">Charge Calculator</h2>
            <p class="text-lg text-gray-700 text-center mb-8">
                Select charges to calculate fines and jail time.
            </p>

            <div class="max-w-3xl mx-auto">
                <!-- Input for new charge - now triggers the modal -->
                <div class="mb-6">
                    <label for="charge-input" class="block text-gray-700 text-lg font-medium mb-2">Click to Add/Select Charges:</label>
                    <input type="text" id="charge-input" placeholder="Click here to open charge selection" readonly
                           class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-800 cursor-pointer">
                </div>

                <!-- Main Clear All Charges button -->
                <div class="flex flex-wrap justify-center gap-4 mb-8">
                    <button id="clear-all-main-charges-btn"
                            class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-md transition duration-300 ease-in-out transform hover:scale-105">
                        Clear All Current Charges
                    </button>
                </div>

                <!-- Display area for added charges -->
                <div class="bg-gray-50 p-6 rounded-lg shadow-inner mb-8 min-h-[150px] border border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">Added Charges:</h3>
                    <ul id="charges-list" class="space-y-2 text-gray-700">
                        <!-- Charges will be dynamically added here -->
                        <li class="text-center text-gray-500 italic" id="no-charges-message">No charges added yet.</li>
                    </ul>
                </div>

                <!-- Calculated totals display -->
                <div class="bg-blue-100 p-6 rounded-lg shadow-md border-2 border-blue-300">
                    <h3 class="text-2xl font-bold text-blue-800 mb-4 text-center">Calculated Totals:</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                        <div>
                            <p class="text-xl text-gray-700 font-semibold">Total Fine:</p>
                            <p id="total-fine" class="text-3xl font-extrabold text-green-700">$0</p>
                        </div>
                        <div>
                            <p class="text-xl text-gray-700 font-semibold">Total Jail Time:</p>
                            <p id="total-jail-time" class="text-3xl font-extrabold text-red-700">0 Months</p>
                        </div>
                    </div>
                </div>
            </div>

            <p class="text-gray-600 text-sm mt-8 text-center">
                This calculator provides estimated values based on current Unified Police Department guidelines. Always confirm with official documentation.
            </p>
        </section>
    </main>

    <!-- Footer Section - Internal Contacts -->
    <footer class="bg-gray-800 text-white py-10 px-6 md:px-12 rounded-t-lg">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <h4 class="text-xl font-semibold mb-4 text-blue-300">Internal Contacts</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="https://discord.gg/7FwxdpfDTM" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Discord</a></li>
                    <li><a href="https://discord.com/channels/1383775098464370768/1396398235660058685" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD Support</a></li>
                    <li><a href="https://discord.com/channels/1383775098464370768/1396398240840290374" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD Chat</a></li>
                    <li><a href="https://discord.com/channels/1383775098464370768/1396398235660058685" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD Internal Affairs</a></li>
                    <li><a href="https://discord.com/channels/1383775098464370768/1396398239678333030" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD Announcements</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-xl font-semibold mb-4 text-blue-300">Quick Access</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="https://docs.google.com/document/d/1etjilZ1dAHGviw33MV5Zs-b5dXqcSHyoYIHvHiRIyy4/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">UPD SOP</a></li>
                    <li><a href="https://docs.google.com/document/d/1hKQ4fw9b1_yQELhPi1p1b4M6uiSaYb7bBp-9C6GVTdY/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Unified Police Department Interview Procedure & Questions</a></li>
                    <li><a href="https://docs.google.com/document/d/1d004FfAhZBgESn88Mx21N3CGqXlcoNeP9_sadn_ePak/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Promotional Pathway & Subdivision Assignment Policy</a></li>
                    <li><a href="https://docs.google.com/document/d/14QIEsYMWpTssti1xGbGWiMxQ2b0jbiYxuMmvV8XWUUo/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Highway Enforcement and Apprehension Team (HEAT) Activation Policy</a></li>
                    <li><a href="https://docs.google.com/document/d/1Ggf7SS5voiIjr3iSLB3VtAc47JN3aDjm2J_gYnpoZ6s/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Disciplinary Guidelines</a></li>
                    <li><a href="privacypolicy.html" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white hover:underline transition duration-300 ease-in-out">Privacy Policy</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-xl font-semibold mb-4 text-blue-300">System Information</h4>
                <p class="text-gray-500 text-sm mb-2">Unauthorized Access Strictly Prohibited</p>
                <p class="text-gray-500 text-sm mb-2">For UPD Personnel Use Only</p>
                <p class="text-500 text-sm mb-2">Created and Maintained by FiveM "NightLife RP"</p>
                <p class="text-gray-500 text-sm">&copy; 2025 Unified Police Department Internal Systems.</p>
            </div>
        </div>
        <!-- Font Awesome for any potential internal icons (though less needed here) -->
        <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    </footer>

    <!-- Charge Selection Modal -->
    <div id="chargeSelectionModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeChargeModalBtn">&times;</button>
            <h2 class="text-2xl font-bold text-blue-800 mb-4">Select Charges</h2>

            <input type="text" id="chargeSearchInput" placeholder="Search for charges..."
                   class="mb-4 p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">

            <div id="available-charges-container" class="grid grid-cols-1 md:grid-cols-2 gap-3 overflow-y-auto max-h-96">
                <!-- Charges will be dynamically loaded here -->
                <div class="loader mx-auto my-4" id="charge-loader"></div>
            </div>

            <div id="modal-selected-charges" class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <h3 class="text-lg font-semibold text-blue-700 mb-2">Selected Charges:</h3>
                <ul id="modal-selected-charges-list" class="space-y-2">
                    <li class="text-center text-gray-500 italic" id="no-modal-selection-message">No charges selected in modal yet.</li>
                </ul>
            </div>

            <div class="flex justify-center gap-4 mt-6">
                <button id="clear-modal-selection-btn"
                        class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">
                    Clear All Selections
                </button>
                <button id="add-selected-charges-btn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out">
                    Add Selected Charges to List
                </button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chargeInput = document.getElementById('charge-input');
            const clearAllMainChargesBtn = document.getElementById('clear-all-main-charges-btn');
            const chargesList = document.getElementById('charges-list');
            const noChargesMessage = document.getElementById('no-charges-message');
            const totalFineDisplay = document.getElementById('total-fine');
            const totalJailTimeDisplay = document.getElementById('total-jail-time');

            // Charge Selection Modal elements
            const chargeSelectionModal = document.getElementById('chargeSelectionModal');
            const closeChargeModalBtn = document.getElementById('closeChargeModalBtn');
            const chargeSearchInput = document.getElementById('chargeSearchInput');
            const availableChargesContainer = document.getElementById('available-charges-container');
            const chargeLoader = document.getElementById('charge-loader'); // New loader for charges
            const modalSelectedChargesList = document.getElementById('modal-selected-charges-list');
            const noModalSelectionMessage = document.getElementById('no-modal-selection-message');
            const clearModalSelectionBtn = document.getElementById('clear-modal-selection-btn');
            const addSelectedChargesBtn = document.getElementById('add-selected-charges-btn');

            // Global array to store charges currently in the main list
            let charges = [];
            // Temporary object to store selected charges within the modal
            let modalSelectedCharges = {};
            // Global object to store fetched charge data
            let chargeData = {};

            // --- Theme Switching Logic (Copied from roster.html) ---
            // Note: The settings modal and related elements (settingsIcon, lightModeRadio, darkModeRadio, etc.)
            // are not present in this specific HTML file (charges.html).
            // The theme application logic is kept, but interaction elements are removed.
            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.body.classList.remove('light-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                    document.body.classList.add('light-mode');
                }
                localStorage.setItem('theme', theme);
            };

            // Apply theme on load
            applyTheme(localStorage.getItem('theme') || 'light');


            /**
             * Fetches charge data from the Google Sheet CSV and populates the global chargeData object.
             */
            async function fetchChargeData() {
                chargeLoader.classList.remove('hidden'); // Show loader
                availableChargesContainer.innerHTML = ''; // Clear previous content

                // Corrected URL for the Google Sheet. Please ensure this sheet is published to web as CSV.
                const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSYcwC9pL7T2jDPO1erEsrKCtdqxROKmhcv1KzvcpdOAqRRcdkUedq04ge1sbFN-52MtgKAorKeMyOK/pub?output=csv';

                try {
                    const response = await fetch(csvUrl);
                    if (!response.ok) {
                        // Enhanced error message for the user
                        availableChargesContainer.innerHTML = `
                                <p class="text-red-500 text-center py-4">
                                    Failed to load charge data. Please ensure the Google Sheet is published to the web as a CSV:<br>
                                    Go to File > Share > Publish to web > Link > Choose the sheet and CSV format.
                                </p>
                            `;
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const csvText = await response.text();

                    const lines = csvText.trim().split('\n');
                    if (lines.length < 3) { // Check if there are enough rows for headers on row 3 and at least one data row
                        availableChargesContainer.innerHTML = '<p class="text-red-500 text-center py-4">Not enough data rows in the CSV. Expected headers on row 3.</p>';
                        return;
                    }

                    // Dynamically get headers from the third line of the CSV (index 2)
                    const headers = lines[2].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(h => h.replace(/^"(.*)"$/, '$1').trim());
                    console.log("CSV Headers found:", headers); // For debugging

                    // Use the provided header names for indexing
                    const chargeIndex = headers.indexOf('Charge');
                    const fineIndex = headers.indexOf('Fine ($)');
                    const jailIndex = headers.indexOf('Jail Time (Months)');

                    if (chargeIndex === -1 || fineIndex === -1 || jailIndex === -1) {
                        availableChargesContainer.innerHTML = `
                                <p class="text-red-500 text-center py-4">
                                    Required columns (Charge, Fine ($), Jail Time (Months)) not found in CSV headers (Row 3).
                                    Please ensure your sheet headers exactly match:
                                    "Title Code", "Charge", "Charge Description", "Classification", "Jail Time (Months)", "Fine ($)"
                                </p>
                            `;
                        throw new Error('Required columns (Charge, Fine ($), Jail Time (Months)) not found in CSV.');
                    }

                    const tempChargeData = {};
                    // Start iterating from the 4th line (index 3) for data
                    for (let i = 3; i < lines.length; i++) {
                        const values = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.replace(/^"(.*)"$/, '$1').trim()); // Split by comma, ignore commas in quotes

                        // Add checks to ensure values exist before accessing them
                        const chargeNameRaw = values[chargeIndex];
                        const fineRaw = values[fineIndex];
                        const jailRaw = values[jailIndex];

                        if (chargeNameRaw === undefined || fineRaw === undefined || jailRaw === undefined) {
                            console.warn(`Skipping row ${i + 1} due to missing data:`, values);
                            continue; // Skip this row if essential data is missing
                        }

                        const chargeName = chargeNameRaw.toLowerCase();
                        const fine = parseInt(fineRaw);
                        let jail = parseInt(jailRaw);

                        // Handle 'Life Sentence' or other non-numeric jail times
                        if (isNaN(jail)) {
                            const jailString = jailRaw.toLowerCase();
                            if (jailString.includes('life')) {
                                jail = 999999; // Assign a large number for life sentence
                            } else if (jailString.includes('< 1')) {
                                jail = 0.5; // Assign a small number for < 1 month
                            } else {
                                jail = 0; // Default to 0 if unknown/invalid
                            }
                        }

                        if (chargeName && !isNaN(fine) && !isNaN(jail)) {
                            tempChargeData[chargeName] = { fine, jail };
                        } else {
                            console.warn(`Skipping row ${i + 1} due to invalid fine/jail time or charge name:`, values);
                        }
                    }
                    chargeData = tempChargeData; // Update global chargeData
                    renderAvailableCharges(); // Render charges in the modal after fetching
                } catch (error) {
                    console.error('Error fetching or parsing charge data:', error);
                    // The specific error message is now handled inside the try block for HTTP errors.
                    // This catch block will handle other parsing errors.
                    if (availableChargesContainer.innerHTML === '') { // Only show generic error if not already showing specific HTTP error
                        availableChargesContainer.innerHTML = '<p class="text-red-500 text-center py-4">An error occurred while loading charge data. Please check the console for details.</p>';
                    }
                } finally {
                    chargeLoader.classList.add('hidden'); // Hide loader
                }
            }

            // Initial fetch of charge data on page load
            fetchChargeData();


            // Charge Selection Modal Logic
            chargeInput.addEventListener('click', () => {
                // Clear previous selections in modal and re-render available charges
                modalSelectedCharges = {};
                renderAvailableCharges();
                renderModalSelectedCharges();
                chargeSelectionModal.classList.remove('hidden');
                chargeSearchInput.value = ''; // Clear search on open
                chargeSearchInput.focus(); // Focus search input
            });

            closeChargeModalBtn.addEventListener('click', () => {
                chargeSelectionModal.classList.add('hidden');
            });

            chargeSearchInput.addEventListener('input', renderAvailableCharges);

            function renderAvailableCharges() {
                availableChargesContainer.innerHTML = '';
                const searchTerm = chargeSearchInput.value.toLowerCase().trim();
                let filteredCharges = Object.keys(chargeData).sort(); // Sort alphabetically

                if (searchTerm) {
                    filteredCharges = filteredCharges.filter(chargeName =>
                        chargeName.includes(searchTerm)
                    );
                }

                if (filteredCharges.length === 0) {
                    availableChargesContainer.innerHTML = '<p class="text-center text-gray-500 py-4">No charges found matching your search.</p>';
                    return;
                }

                filteredCharges.forEach(chargeName => {
                    const chargeItemDiv = document.createElement('div');
                    chargeItemDiv.classList.add('charge-item', 'rounded-md', 'shadow-sm', 'text-gray-800');
                    if (modalSelectedCharges[chargeName]) {
                        chargeItemDiv.classList.add('selected');
                    }
                    chargeItemDiv.dataset.chargeName = chargeName;
                    chargeItemDiv.textContent = chargeName.charAt(0).toUpperCase() + chargeName.slice(1); // Capitalize first letter

                    chargeItemDiv.addEventListener('click', () => {
                        toggleChargeSelection(chargeName);
                    });
                    availableChargesContainer.appendChild(chargeItemDiv);
                });
            }

            function toggleChargeSelection(chargeName) {
                if (modalSelectedCharges[chargeName]) {
                    // If already selected, unselect it
                    delete modalSelectedCharges[chargeName];
                } else {
                    // If not selected, add it with quantity 1
                    modalSelectedCharges[chargeName] = { name: chargeName, quantity: 1 };
                }
                renderAvailableCharges(); // Re-render to update selected visual state
                renderModalSelectedCharges();
            }

            function renderModalSelectedCharges() {
                modalSelectedChargesList.innerHTML = '';
                const selectedChargeNames = Object.keys(modalSelectedCharges).sort();

                if (selectedChargeNames.length === 0) {
                    noModalSelectionMessage.classList.remove('hidden');
                } else {
                    noModalSelectionMessage.classList.add('hidden');
                    selectedChargeNames.forEach(chargeName => {
                        const charge = modalSelectedCharges[chargeName];
                        const li = document.createElement('li');
                        li.classList.add('modal-selected-charge-item');
                        li.innerHTML = `
                                                        <span class="flex-grow">${charge.name.charAt(0).toUpperCase() + charge.name.slice(1)}</span>
                                                        <input type="number" min="1" value="${charge.quantity}" data-charge-name="${charge.name}" class="quantity-input">
                                                        <button class="remove-modal-charge-btn text-red-500 hover:text-red-700 font-bold px-2 rounded-full ml-2" data-charge-name="${charge.name}">&times;</button>
                                                    `;
                        modalSelectedChargesList.appendChild(li);
                    });

                    // Add event listeners for quantity inputs and remove buttons
                    modalSelectedChargesList.querySelectorAll('.quantity-input').forEach(input => {
                        input.addEventListener('change', (event) => {
                            const chargeName = event.target.dataset.chargeName;
                            const newQuantity = parseInt(event.target.value);
                            if (newQuantity > 0) {
                                modalSelectedCharges[chargeName].quantity = newQuantity;
                            } else {
                                event.target.value = modalSelectedCharges[chargeName].quantity; // Revert to current if invalid
                            }
                        });
                    });

                    modalSelectedChargesList.querySelectorAll('.remove-modal-charge-btn').forEach(button => {
                        button.addEventListener('click', (event) => {
                            const chargeName = event.target.dataset.chargeName;
                            toggleChargeSelection(chargeName); // Use toggle to remove
                        });
                    });
                }
            }

            clearModalSelectionBtn.addEventListener('click', () => {
                modalSelectedCharges = {};
                renderAvailableCharges();
                renderModalSelectedCharges();
            });

            addSelectedChargesBtn.addEventListener('click', () => {
                // Add selected charges from modal to the main list
                Object.values(modalSelectedCharges).forEach(selectedCharge => {
                    const existingChargeIndex = charges.findIndex(c => c.name === selectedCharge.name);

                    if (existingChargeIndex > -1) {
                        charges[existingChargeIndex].quantity += selectedCharge.quantity;
                    } else {
                        charges.push({ ...selectedCharge });
                    }
                });

                charges.sort((a, b) => a.name.localeCompare(b.name));

                renderCharges(); // Render main charges list
                calculateTotals();
                chargeSelectionModal.classList.add('hidden'); // Close modal
            });

            // Main List functionality
            clearAllMainChargesBtn.addEventListener('click', () => {
                charges = [];
                renderCharges();
                calculateTotals();
                noChargesMessage.classList.remove('hidden'); // Show "No charges added yet." message
            });

            function renderCharges() {
                chargesList.innerHTML = ''; // Clear existing list items
                if (charges.length === 0) {
                    noChargesMessage.classList.remove('hidden');
                } else {
                    noChargesMessage.classList.add('hidden');
                    charges.forEach((charge, index) => {
                        const li = document.createElement('li');
                        li.className = 'flex items-center justify-between bg-white p-3 rounded-md shadow-sm border border-gray-100';
                        li.innerHTML = `
                                                        <span>${charge.name.charAt(0).toUpperCase() + charge.name.slice(1)} (x${charge.quantity})</span>
                                                        <button class="remove-main-charge-btn text-red-500 hover:text-red-700 font-bold px-2 rounded-full" data-index="${index}">&times;</button>
                                                    `;
                        chargesList.appendChild(li);
                    });
                }
            }

            // Event delegation for removing individual charges from the main list
            chargesList.addEventListener('click', (event) => {
                if (event.target.classList.contains('remove-main-charge-btn')) {
                    const indexToRemove = parseInt(event.target.dataset.index);
                    charges.splice(indexToRemove, 1);
                    renderCharges();
                    calculateTotals();
                }
            });

            function calculateTotals() {
                let totalFine = 0;
                let totalJailTime = 0;

                charges.forEach(chargeObj => {
                    const normalizedChargeName = chargeObj.name.toLowerCase().trim();
                    let chargeInfo = chargeData[normalizedChargeName];

                    if (chargeInfo) {
                        totalFine += chargeInfo.fine * chargeObj.quantity;
                        totalJailTime += chargeInfo.jail * chargeObj.quantity;
                    } else {
                        console.warn(`Charge "${chargeObj.name}" not found in data. Fine and jail time not added for this charge.`);
                    }
                });

                totalFineDisplay.textContent = `$${totalFine.toLocaleString()}`;

                if (totalJailTime >= 999999) {
                    totalJailTimeDisplay.textContent = 'Life Sentence';
                } else if (totalJailTime > 0 && totalJailTime < 1) {
                    totalJailTimeDisplay.textContent = '< 1 Month';
                } else {
                    totalJailTimeDisplay.textContent = `${totalJailTime} Months`;
                }
            }
        });
    </script>
</body>
</html>
